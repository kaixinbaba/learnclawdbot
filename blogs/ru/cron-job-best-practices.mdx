---
title: Лучшие практики Cron-задач OpenClaw - Избежание раздувания сессий и проблем с памятью
description: Узнайте как правильно настроить cron-задачи OpenClaw, предотвратить накопление сессий и выбрать между основной и изолированной сессией
slug: /cron-job-best-practices
publishedAt: 2026-02-14
status: published
visibility: public
featuredImageUrl: /images/features/cron-job-best-practices.webp
---

# Лучшие практики Cron-задач OpenClaw

Cron-задачи необходимы для автоматизации повторяющихся задач в OpenClaw — от ежедневных сводок до периодического мониторинга. Однако неправильная настройка может привести к раздуванию сессий, проблемам с памятью и неконтролируемым расходам. Это руководство охватывает лучшие практики настройки надёжных и эффективных cron-задач.

## Проблема накопления сессий

Одна из самых распространённых проблем с cron-задачами OpenClaw — **накопление контекста сессии**. Вот как это происходит:

1. Вы создаёте изолированную cron-задачу, запускающуюся каждый час
2. Каждый запуск добавляет больше контекста в сессию
3. За дни/недели сессия растёт неограниченно
4. В конце концов контекст достигает лимита, и задача падает или становится дорогой

Это была известная проблема в репозитории OpenClaw, где изолированные cron-сессии бесконечно накапливали контекст.

## Понимание режимов выполнения Cron

Cron-задачи OpenClaw могут работать в двух режимах, и выбор правильного критически важен:

### Задачи основной сессии

Задачи основной сессии внедряют системное событие в вашу первичную сессию:

```bash
openclaw cron add \
  --name "Проверка почты" \
  --cron "0 * * * *" \
  --session main \
  --system-event "Проверить почту на срочные письма" \
  --wake now
```

**Характеристики:**
- Выполняется в контексте основной сессии
- Имеет доступ к полной истории разговоров
- Делит контекст с обычными взаимодействиями
- Подходит для задач, требующих осведомлённости о разговоре

**Когда использовать:**
- Задачи, которым нужно знать недавние разговоры
- Напоминания-продолжения на основе предыдущего контекста
- Лёгкие проверки, естественно интегрирующиеся в рабочий процесс

### Изолированные задачи

Изолированные задачи выполняются в выделенной сессии `cron:<jobId>`:

```bash
openclaw cron add \
  --name "Ежедневный отчёт" \
  --cron "0 9 * * *" \
  --tz "Europe/Moscow" \
  --session isolated \
  --message "Сгенерировать ежедневный отчёт о статусе" \
  --announce
```

**Характеристики:**
- Каждый запуск начинается с чистой сессии (без переноса контекста)
- Можно использовать другие настройки модели/мышления
- Вывод анонсируется напрямую в канал
- История не засоряет основную сессию

**Когда использовать:**
- Автономные задачи, не требующие предыдущего контекста
- Тяжёлый анализ с другими требованиями к модели
- Частые задачи, которые бы спамили историю основной сессии
- Задачи, требующие выполнения с чистого листа

## Лучшая практика #1: Используйте изолированные задачи с Announce

Для большинства повторяющейся автоматизации используйте изолированные задачи с доставкой announce:

```bash
openclaw cron add \
  --name "Утренняя сводка" \
  --cron "0 7 * * *" \
  --tz "Europe/Moscow" \
  --session isolated \
  --message "Резюме: погода, календарь, важные письма." \
  --announce \
  --channel telegram \
  --to "123456789"
```

Это гарантирует:
- Свежий контекст при каждом запуске (без накопления)
- Результаты доставляются напрямую в чат
- Основная сессия остаётся чистой
- Предсказуемое использование ресурсов

## Лучшая практика #2: Одноразовые задачи автоудаляются

Для напоминаний и одноразовых задач используйте `--at` с `--delete-after-run`:

```bash
openclaw cron add \
  --name "Напоминание о встрече" \
  --at "20m" \
  --session main \
  --system-event "Стендап начинается через 10 минут!" \
  --wake now \
  --delete-after-run
```

Одноразовые задачи (`--at`) удаляются после успеха по умолчанию. Используйте `--keep-after-run` только если нужно сохранить запись о задаче.

## Лучшая практика #3: Группируйте проверки в Heartbeat

Вместо создания нескольких cron-задач для периодических проверок используйте механизм heartbeat:

**HEARTBEAT.md:**
```markdown
# Чеклист Heartbeat

- Проверить почту на срочные сообщения
- Посмотреть события календаря на ближайшие 2 часа
- Проверить статус проекта
- Если тихо более 8 часов, лёгкий чекин
```

**Почему это лучше:**
- Один ход агента обрабатывает несколько проверок
- Уменьшает вызовы API и расходы
- Приоритизация с учётом контекста
- Естественная группировка связанных задач

## Лучшая практика #4: Выбирайте правильный тип расписания

OpenClaw поддерживает три типа расписаний:

### Одноразовое (`--at`)

Для конкретного времени в будущем:

```bash
# Относительное время
openclaw cron add --at "2h" --name "..." ...

# Абсолютное время (ISO 8601, UTC без часового пояса)
openclaw cron add --at "2026-02-15T14:00:00Z" --name "..." ...
```

### Интервал (`--every`)

Для фиксированных интервалов:

```bash
# Каждые 4 часа
openclaw cron add --every "4h" --name "..." ...
```

### Cron-выражение (`--cron`)

Для сложных расписаний:

```bash
# Каждый понедельник в 9 утра
openclaw cron add --cron "0 9 * * 1" --tz "Europe/Moscow" --name "..." ...

# Каждый будний день в 8:30
openclaw cron add --cron "30 8 * * 1-5" --tz "Europe/Moscow" --name "..." ...
```

**Важно:** Всегда указывайте `--tz` для cron-выражений, чтобы избежать путаницы с часовыми поясами.

## Лучшая практика #5: Переопределение модели и мышления

Для тяжёлого анализа переопределяйте модель в изолированных задачах:

```bash
openclaw cron add \
  --name "Еженедельный глубокий анализ" \
  --cron "0 6 * * 0" \
  --session isolated \
  --message "Глубокий анализ прогресса проекта, блокеров и рекомендаций." \
  --model opus \
  --thinking high \
  --announce
```

**Рекомендации:**
- Используйте дешёвые модели (sonnet) для рутинных задач
- Резервируйте дорогие модели (opus) для сложного анализа
- Уровни мышления: `off`, `minimal`, `low`, `medium`, `high`, `xhigh`

## Лучшая практика #6: Правильная настройка доставки

Для изолированных задач настраивайте доставку явно:

```bash
# Анонс в конкретный канал
openclaw cron add \
  --session isolated \
  --message "..." \
  --announce \
  --channel whatsapp \
  --to "+79161234567"

# Поддержка тем/тредов Telegram
openclaw cron add \
  --session isolated \
  --message "..." \
  --announce \
  --channel telegram \
  --to "-1001234567890:topic:123"

# Без доставки (только внутренне)
openclaw cron add \
  --session isolated \
  --message "..." \
  --no-deliver
```

**Режимы доставки:**
- `--announce`: Доставить резюме в целевой канал (по умолчанию для изолированных)
- `--no-deliver`: Держать вывод внутренне, без анонса

## Устранение распространённых проблем

### Задачи не запускаются

1. **Проверьте включён ли cron:**
   ```bash
   openclaw cron status
   ```

2. **Убедитесь что Gateway работает:**
   ```bash
   openclaw gateway status
   ```

3. **Проверьте настройки часового пояса:**
   ```bash
   openclaw cron list --json | jq '.[] | {name, schedule}'
   ```

### Раздувание сессии (устаревшие задачи)

Если есть старые задачи с накопленным контекстом:

1. Список всех задач:
   ```bash
   openclaw cron list
   ```

2. Удалить проблемные задачи:
   ```bash
   openclaw cron remove <job-id>
   ```

3. Пересоздать с изолированным режимом:
   ```bash
   openclaw cron add --session isolated ...
   ```

### Сбои доставки

Если анонсы не доходят до чата:

1. Проверить конфигурацию доставки:
   ```bash
   openclaw cron list --json | jq '.[] | {name, delivery}'
   ```

2. Проверить формат канала/цели:
   - Telegram: ID чата или `chat_id:topic:thread_id`
   - WhatsApp: номер телефона с кодом страны
   - Discord/Slack: `channel:ID` или `user:ID`

3. Используйте `--best-effort` чтобы предотвратить сбой задачи при проблемах доставки:
   ```bash
   openclaw cron edit <job-id> --best-effort
   ```

## Краткий справочник: Cron vs Heartbeat

| Сценарий | Рекомендуется | Причина |
|----------|--------------|---------|
| Проверка почты каждые 30 мин | Heartbeat | Группируется с другими проверками |
| Отчёт ровно в 9 утра ежедневно | Cron (изолированный) | Нужно точное время |
| "Напомни через 20 мин" | Cron (основной, `--at`) | Точное одноразовое |
| Еженедельный глубокий анализ | Cron (изолированный) | Другая модель, чистый лист |
| Фоновый мониторинг | Heartbeat | Использует существующий цикл |

## Резюме

1. **Используйте изолированные задачи** для повторяющейся автоматизации чтобы избежать раздувания сессии
2. **Используйте heartbeat** для группировки нескольких периодических проверок
3. **Всегда указывайте часовой пояс** для cron-выражений
4. **Переопределяйте модели соответственно** сложности задачи
5. **Настраивайте доставку явно** для изолированных задач
6. **Используйте `--delete-after-run`** для одноразовых напоминаний
7. **Мониторьте здоровье задач** через `openclaw cron list` и `openclaw cron runs`

С этими практиками ваши cron-задачи будут работать надёжно без накопления контекста или проблем с производительностью.
