---
title: "Как интегрировать Feishu/Lark с AI-ботом OpenClaw"
description: "Полное руководство по подключению AI-ассистента OpenClaw к корпоративным платформам обмена сообщениями Feishu (Китай) и Lark (международная версия). Узнайте о настройке, конфигурации и расширенных функциях для китайского корпоративного сотрудничества."
slug: /feishu-lark-integration
tags: Feishu, Lark, Enterprise, Integration, Chinese Market, WebSocket, AI Bot
publishedAt: 2026-02-16
status: published
visibility: public
featuredImageUrl: /images/features/feishu-lark-integration.webp
---

# Как интегрировать Feishu/Lark с AI-ботом OpenClaw

Feishu (飞书) и Lark — это корпоративные платформы обмена сообщениями, широко используемые в китайских и международных компаниях для командной работы. Это руководство показывает, как подключить вашего AI-ассистента OpenClaw к Feishu/Lark с помощью подписки на события на основе WebSocket, обеспечивая бесшовное взаимодействие с AI в вашей корпоративной чат-среде.

## В чём разница между Feishu и Lark?

- **Feishu (飞书)**: Китайская версия, используемая китайскими предприятиями. Платформа: `https://open.feishu.cn`
- **Lark**: Международная версия, используемая по всему миру. Платформа: `https://open.larksuite.com`

Обе используют одинаковую архитектуру API, но вам нужно настроить правильный домен в OpenClaw.

---

## Предварительные требования

Перед началом убедитесь, что у вас есть:

- Установлен и запущен OpenClaw
- Учётная запись Feishu/Lark с правами администратора для создания корпоративных приложений
- Базовые знания терминала/командной строки

---

## Шаг 1: Установите плагин Feishu

Сначала установите официальный плагин Feishu для OpenClaw:

```bash
openclaw plugins install @openclaw/feishu
```

Если вы работаете из git-репозитория:

```bash
openclaw plugins install ./extensions/feishu
```

---

## Шаг 2: Создайте приложение Feishu/Lark

### 1. Откройте платформу для разработчиков

Перейдите на соответствующую платформу в зависимости от вашего региона:

- **Feishu (Китай)**: [https://open.feishu.cn/app](https://open.feishu.cn/app)
- **Lark (международная)**: [https://open.larksuite.com/app](https://open.larksuite.com/app)

Войдите в свою учётную запись.

### 2. Создайте корпоративное приложение

1. Нажмите **Создать корпоративное приложение**
2. Заполните название и описание приложения
3. Выберите иконку приложения

### 3. Скопируйте учётные данные

Из раздела **Учётные данные и базовая информация** скопируйте:

- **App ID** (формат: `cli_xxx`)
- **App Secret**

⚠️ **Важно**: Храните App Secret в секрете и никогда не коммитьте его в систему контроля версий.

### 4. Настройте разрешения

На странице **Разрешения** нажмите **Массовый импорт** и вставьте этот JSON:

```json
\{
  "scopes": \{
    "tenant": [
      "aily:file:read",
      "aily:file:write",
      "application:application.app_message_stats.overview:readonly",
      "application:application:self_manage",
      "application:bot.menu:write",
      "contact:user.employee_id:readonly",
      "corehr:file:download",
      "event:ip_list",
      "im:chat.access_event.bot_p2p_chat:read",
      "im:chat.members:bot_access",
      "im:message",
      "im:message.group_at_msg:readonly",
      "im:message.p2p_msg:readonly",
      "im:message:readonly",
      "im:message:send_as_bot",
      "im:resource"
    ],
    "user": [
      "aily:file:read",
      "aily:file:write",
      "im:chat.access_event.bot_p2p_chat:read"
    ]
  \}
\}
```

Это предоставит боту все необходимые разрешения для отправки/получения сообщений, доступа к файлам и управления функциями бота.

### 5. Включите возможности бота

В разделе **Возможности приложения** > **Бот**:

1. Включите возможности бота
2. Задайте имя бота

### 6. Настройте подписку на события

⚠️ **Критически важно**: Перед настройкой подписки на события убедитесь, что:

1. Вы уже добавили канал Feishu в OpenClaw (см. Шаг 3)
2. Шлюз OpenClaw запущен (`openclaw gateway status`)

В разделе **Подписка на события**:

1. Выберите **Использовать длительное соединение для получения событий** (режим WebSocket)
2. Добавьте событие: `im.message.receive_v1`

⚠️ Если шлюз не запущен, настройка WebSocket-соединения не удастся.

### 7. Опубликуйте приложение

1. Создайте версию в разделе **Управление версиями и публикация**
2. Отправьте на проверку и опубликуйте
3. Дождитесь одобрения администратора (корпоративные приложения обычно одобряются автоматически)

---

## Шаг 3: Настройте OpenClaw

### Метод 1: Интерактивная настройка (рекомендуется)

Запустите мастер настройки канала:

```bash
openclaw channels add
```

Выберите **Feishu** и введите ваши App ID и App Secret при появлении запроса.

### Метод 2: Ручная настройка

Отредактируйте `~/.openclaw/openclaw.json`:

```json5
\{
  channels: \{
    feishu: \{
      enabled: true,
      dmPolicy: "pairing",
      accounts: \{
        main: \{
          appId: "cli_xxx",
          appSecret: "xxx",
          botName: "Мой AI-ассистент",
        \},
      \},
    \},
  \},
\}
```

### Для Lark (международная версия)

Если вы используете Lark вместо Feishu, добавьте настройку `domain`:

```json5
\{
  channels: \{
    feishu: \{
      domain: "lark",
      accounts: \{
        main: \{
          appId: "cli_xxx",
          appSecret: "xxx",
        \},
      \},
    \},
  \},
\}
```

---

## Шаг 4: Запуск и тестирование

### 1. Запустите шлюз

```bash
openclaw gateway
```

Проверьте статус шлюза:

```bash
openclaw gateway status
```

### 2. Отправьте тестовое сообщение

В Feishu/Lark найдите вашего бота и отправьте сообщение.

### 3. Одобрите сопряжение

По умолчанию бот использует режим сопряжения для безопасности. Когда новый пользователь отправляет сообщение боту, он получает код сопряжения.

Одобрите сопряжение:

```bash
openclaw pairing list feishu
openclaw pairing approve feishu <КОД>
```

После одобрения вы можете нормально общаться с ботом.

---

## Расширенные функции

### Настройка групповых чатов

**Поведение по умолчанию**: В групповых чатах бот требует @упоминания для ответа.

Чтобы разрешить боту отвечать без @упоминания в определённой группе:

```json5
\{
  channels: \{
    feishu: \{
      groups: \{
        oc_xxx: \{ requireMention: false \},
      \},
    \},
  \},
\}
```

**Получить ID группы**: Отправьте сообщение в группе с @упоминанием, затем проверьте логи:

```bash
openclaw logs --follow
```

Найдите `chat_id` (формат: `oc_xxx`).

### Политики контроля доступа

**Политика личных сообщений** (`dmPolicy`):

- `"pairing"` (по умолчанию): Требуется одобрение администратора для новых пользователей
- `"allowlist"`: Только определённые пользователи могут общаться
- `"open"`: Разрешить всем (требует `"*"` в allowFrom)
- `"disabled"`: Отключить личные сообщения

**Политика групп** (`groupPolicy`):

- `"open"` (по умолчанию): Разрешить всем пользователям в группах
- `"allowlist"`: Только определённым пользователям в `groupAllowFrom`
- `"disabled"`: Отключить групповые сообщения

Пример конфигурации списка разрешённых:

```json5
\{
  channels: \{
    feishu: \{
      groupPolicy: "allowlist",
      groupAllowFrom: ["ou_xxx", "ou_yyy"],
    \},
  \},
\}
```

### Несколько учётных записей

Вы можете управлять несколькими ботами Feishu/Lark:

```json5
\{
  channels: \{
    feishu: \{
      accounts: \{
        main: \{
          appId: "cli_xxx",
          appSecret: "xxx",
          botName: "Основной бот",
        \},
        backup: \{
          appId: "cli_yyy",
          appSecret: "yyy",
          botName: "Резервный бот",
          enabled: false,
        \},
      \},
    \},
  \},
\}
```

---

## Устранение неполадок

### Бот не отвечает в группах

1. Убедитесь, что бот добавлен в группу
2. Убедитесь, что вы @упомянули бота (поведение по умолчанию)
3. Проверьте, что `groupPolicy` не установлена в `"disabled"`
4. Проверьте логи: `openclaw logs --follow`

### Бот не получает сообщения

1. Убедитесь, что приложение опубликовано и одобрено
2. Убедитесь, что подписка на события включает `im.message.receive_v1`
3. Убедитесь, что включено **длительное соединение** (WebSocket)
4. Убедитесь, что все разрешения предоставлены
5. Убедитесь, что шлюз запущен: `openclaw gateway status`
6. Проверьте логи: `openclaw logs --follow`

### Утечка App Secret

1. Сбросьте App Secret на открытой платформе Feishu/Lark
2. Обновите App Secret в конфигурации OpenClaw
3. Перезапустите шлюз: `openclaw gateway restart`

### Ошибки отправки сообщений

1. Убедитесь, что у приложения есть разрешение `im:message:send_as_bot`
2. Убедитесь, что приложение опубликовано
3. Проверьте логи для получения подробных сообщений об ошибках

---

## Общие команды

| Команда   | Описание                   |
| --------- | -------------------------- |
| `/status` | Показать статус бота       |
| `/reset`  | Сбросить сессию            |
| `/model`  | Показать/переключить модель |

---

## Поддерживаемые типы сообщений

**Получение**:
- ✅ Текст
- ✅ Изображения
- ✅ Файлы
- ✅ Аудио
- ✅ Видео
- ✅ Стикеры

**Отправка**:
- ✅ Текст
- ✅ Изображения
- ✅ Файлы
- ✅ Аудио
- ⚠️ Форматированный текст (частичная поддержка)

---

## Заключение

Вы успешно интегрировали OpenClaw с Feishu/Lark! Эта настройка позволяет вашей команде взаимодействовать с AI напрямую на корпоративной платформе обмена сообщениями, независимо от того, используете ли вы китайскую версию Feishu или международную версию Lark.

**Ключевые моменты**:
- Feishu и Lark используют один и тот же API, отличаются только домены
- Режим WebSocket устраняет необходимость в публичных webhook URL
- Режим сопряжения обеспечивает безопасный контроль доступа для корпоративного использования
- Полная поддержка как личных, так и групповых чатов с гибкими политиками

Для получения дополнительных параметров конфигурации ознакомьтесь с [официальной документацией OpenClaw](https://docs.openclaw.ai).
