---
title: "修正：LLM Request Rejected - Unexpected tool_use_id in tool_result Blocks"
description: "OpenClaw で 'unexpected tool_use_id found in tool_result blocks' エラーを破損したセッションファイルのクリアで解決する方法"
slug: /troubleshooting/fix-tool-use-id-error
publishedAt: 2026-02-01
status: published
visibility: public
isPinned: false
featuredImageUrl: /images/features/fix_tool_use_id_head.webp
---

# 修正：LLM Request Rejected — Unexpected tool_use_id in tool_result Blocks

OpenClaw を使用中に突然このエラーが発生した場合：

```
LLM request rejected: messages.58.content.1: unexpected tool_use_id found
in tool_result blocks: toolu_01BuEWGgvuHAY9iAXdbCpCEw.
Each tool_result block must have a corresponding tool_use block in the
previous message.
```

慌てないでください。これは**セッションファイルの破損**の問題であり、簡単に修正できます。

## エラーの原因

OpenClaw が LLM（Claude など）と通信する際、会話履歴を一連のメッセージとして送信します。各 `tool_result` ブロックは、前のメッセージの `tool_use` ブロックを参照する必要があります — これらはペアで動作します。

セッション履歴の同期が崩れるとこのエラーが発生します：

- **セッションコンパクション** が `tool_use` ブロックを削除したが `tool_result` を残した
- プロセスが**会話の途中で中断**された（クラッシュ、強制終了、ネットワークタイムアウト）
- セッションファイルの**手動編集**によりメッセージチェーンが壊れた

LLM API はメッセージ構造を厳密に検証します。前のメッセージに存在しない `tool_use_id` を参照する `tool_result` を見つけると、リクエスト全体を拒否します。

## 修正方法：破損したセッションファイルを削除

### ステップ 1：セッションディレクトリを見つける

OpenClaw はセッション記録を `.jsonl` ファイルとして保存します。場所は設定によって異なります：

```bash
# macOS/Linux のデフォルトの場所
~/.openclaw/agents/main/sessions/

# ワークスペースを確認
ls -lt ~/.openclaw/agents/main/sessions/*.jsonl | head -5
```

### ステップ 2：破損したファイルを特定する

最近変更された `.jsonl` ファイルが原因である可能性が高いです：

```bash
# 変更日時でソート（最新が先頭）
ls -lt ~/.openclaw/agents/main/sessions/*.jsonl | head -5
```

以下のような出力が表示されます：

```
-rw-r--r--  1 user  staff  245632 Feb  1 12:30 abc123-def456.jsonl
-rw-r--r--  1 user  staff  189421 Feb  1 10:15 789ghi-012jkl.jsonl
```

### ステップ 3：破損したセッションを削除

```bash
# 最新のセッションファイルを削除
rm ~/.openclaw/agents/main/sessions/<破損したファイル>.jsonl
```

より安全な方法：

```bash
# 削除せずに移動
mv ~/.openclaw/agents/main/sessions/<破損したファイル>.jsonl /tmp/
```

### ステップ 4：ゲートウェイを再起動

```bash
openclaw gateway restart
```

以上です。OpenClaw は新しいセッションを開始し、エラーは解消されるはずです。

## 予防のヒント

1. **ツール実行中に OpenClaw を強制終了しない** — 完了を待つか `/abort` コマンドを使用してください
2. **`.jsonl` ファイルを手動で編集しない** — これらは機械生成のセッション記録です
3. **定期的なゲートウェイの再起動** は古いセッション状態のクリアに役立ちます
4. コンパクションの問題が頻繁に発生する場合は、ゲートウェイ設定で `compaction` 設定の調整を検討してください

## エラーメッセージの理解

エラーを分解してみましょう：

| 部分 | 意味 |
|------|------|
| `messages.58.content.1` | 59 番目のメッセージ（0始まり）、2 番目のコンテンツブロック |
| `unexpected tool_use_id` | 存在しない tool_use を参照する tool_result が見つかった |
| `toolu_01BuEWGgvuHAY9iAXdbCpCEw` | 孤立したツールコール ID |
| `Each tool_result block must have a corresponding tool_use block` | API の検証ルール |

## 関連する問題

- **"All models failed"** — 別の問題の可能性があります。API キーとモデル設定を確認してください。
- **"Session too large"** — セッション履歴が長すぎる可能性があります。OpenClaw は自動コンパクションでこれを処理します。
- **ゲートウェイが起動しない** — `openclaw doctor` を実行して問題を診断してみてください。

## まとめ

| 問題 | 孤立した tool_result ブロックを含む破損したセッションファイル |
|------|-----------------------------------------------------------|
| 原因 | セッションコンパクション、クラッシュ、またはツール実行中の中断 |
| 修正 | sessions ディレクトリ内の最新の `.jsonl` ファイルを削除 |
| 修正時間 | 30 秒 |
| 予防 | ツール実行中に強制終了しない |

怖く見えるエラーですが、修正はシンプルです。遭遇したら、セッションをクリアして先に進みましょう。Happy automating! 🚀
