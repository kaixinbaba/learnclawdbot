---
title: "如何将飞书/Lark 与 OpenClaw AI 机器人集成"
description: "完整指南：将 OpenClaw AI 助手连接到飞书（中国版）和 Lark（国际版）企业通讯平台。了解设置、配置和高级功能，专为中国企业协作打造。"
slug: /feishu-lark-integration
publishedAt: 2026-02-16
status: published
visibility: public
featuredImageUrl: /images/features/feishu-lark-integration.webp
---

# 如何将飞书/Lark 与 OpenClaw AI 机器人集成

飞书和 Lark 是广泛应用于中国及全球企业的团队协作平台。本指南将向您展示如何使用基于 WebSocket 的事件订阅将 OpenClaw AI 助手连接到飞书/Lark，在企业聊天环境中实现无缝的 AI 交互。

## 飞书和 Lark 有什么区别?

- **飞书**: 中国版本，面向中国企业。平台：`https://open.feishu.cn`
- **Lark**: 国际版本，面向全球用户。平台：`https://open.larksuite.com`

两者使用相同的 API 架构，但您需要在 OpenClaw 中配置正确的域名。

---

## 前提条件

开始之前，请确保您已具备：

- 已安装并运行 OpenClaw
- 拥有飞书/Lark 账号，并具有创建企业应用的管理员权限
- 基本熟悉终端/命令行操作

---

## 步骤 1: 安装飞书插件

首先，安装 OpenClaw 官方飞书插件：

```bash
openclaw plugins install @openclaw/feishu
```

如果您从 git 仓库运行：

```bash
openclaw plugins install ./extensions/feishu
```

---

## 步骤 2: 创建飞书/Lark 应用

### 1. 打开开发者平台

根据您的地区访问相应平台：

- **飞书（中国）**: [https://open.feishu.cn/app](https://open.feishu.cn/app)
- **Lark（国际）**: [https://open.larksuite.com/app](https://open.larksuite.com/app)

使用您的账号登录。

### 2. 创建企业自建应用

1. 点击**创建企业自建应用**
2. 填写应用名称和描述
3. 选择应用图标

### 3. 复制应用凭证

在**凭证与基础信息**页面，复制：

- **App ID**（格式：`cli_xxx`）
- **App Secret**

⚠️ **重要提示**：请妥善保管 App Secret，切勿将其提交到版本控制系统。

### 4. 配置权限

在**权限管理**页面，点击**批量导入**并粘贴以下 JSON：

```json
{
  "scopes": {
    "tenant": [
      "aily:file:read",
      "aily:file:write",
      "application:application.app_message_stats.overview:readonly",
      "application:application:self_manage",
      "application:bot.menu:write",
      "contact:user.employee_id:readonly",
      "corehr:file:download",
      "event:ip_list",
      "im:chat.access_event.bot_p2p_chat:read",
      "im:chat.members:bot_access",
      "im:message",
      "im:message.group_at_msg:readonly",
      "im:message.p2p_msg:readonly",
      "im:message:readonly",
      "im:message:send_as_bot",
      "im:resource"
    ],
    "user": [
      "aily:file:read",
      "aily:file:write",
      "im:chat.access_event.bot_p2p_chat:read"
    ]
  }
}
```

这将授予机器人发送/接收消息、访问文件和管理机器人功能所需的所有权限。

### 5. 启用机器人能力

在**应用能力** > **机器人**页面：

1. 启用机器人能力
2. 设置机器人名称

### 6. 配置事件订阅

⚠️ **关键步骤**：在设置事件订阅之前，请确保：

1. 您已将飞书渠道添加到 OpenClaw（见步骤 3）
2. OpenClaw 网关正在运行（`openclaw gateway status`）

在**事件订阅**页面：

1. 选择**使用长连接接收事件**（WebSocket 模式）
2. 添加事件：`im.message.receive_v1`

⚠️ 如果网关未运行，WebSocket 连接设置将失败。

### 7. 发布应用

1. 在**版本管理与发布**中创建版本
2. 提交审核并发布
3. 等待管理员审批（企业自建应用通常自动通过）

---

## 步骤 3: 配置 OpenClaw

### 方法 1: 交互式设置（推荐）

运行渠道设置向导：

```bash
openclaw channels add
```

选择 **Feishu** 并在提示时输入您的 App ID 和 App Secret。

### 方法 2: 手动配置

编辑 `~/.openclaw/openclaw.json`：

```json5
{
  channels: {
    feishu: {
      enabled: true,
      dmPolicy: "pairing",
      accounts: {
        main: {
          appId: "cli_xxx",
          appSecret: "xxx",
          botName: "我的 AI 助手",
        },
      },
    },
  },
}
```

### 对于 Lark（国际版）

如果您使用 Lark 而非飞书，请添加 `domain` 设置：

```json5
{
  channels: {
    feishu: {
      domain: "lark",
      accounts: {
        main: {
          appId: "cli_xxx",
          appSecret: "xxx",
        },
      },
    },
  },
}
```

---

## 步骤 4: 启动并测试

### 1. 启动网关

```bash
openclaw gateway
```

检查网关状态：

```bash
openclaw gateway status
```

### 2. 发送测试消息

在飞书/Lark 中找到您的机器人并发送消息。

### 3. 批准配对

默认情况下，机器人使用配对模式以保证安全性。当新用户给机器人发消息时，他们会收到一个配对码。

批准配对：

```bash
openclaw pairing list feishu
openclaw pairing approve feishu <配对码>
```

批准后，您就可以正常与机器人聊天了。

---

## 高级功能

### 群聊配置

**默认行为**：在群聊中，机器人需要 @提及才会响应。

要允许机器人在特定群组中无需 @提及即可响应：

```json5
{
  channels: {
    feishu: {
      groups: {
        oc_xxx: { requireMention: false },
      },
    },
  },
}
```

**获取群组 ID**：在群组中发送带 @提及的消息，然后查看日志：

```bash
openclaw logs --follow
```

查找 `chat_id`（格式：`oc_xxx`）。

### 访问控制策略

**私聊策略**（`dmPolicy`）：

- `"pairing"`（默认）：新用户需要管理员批准
- `"allowlist"`：仅特定用户可以聊天
- `"open"`：允许所有人（需要在 allowFrom 中添加 `"*"`）
- `"disabled"`：禁用私聊

**群组策略**（`groupPolicy`）：

- `"open"`（默认）：允许群组中的所有用户
- `"allowlist"`：仅允许 `groupAllowFrom` 中的特定用户
- `"disabled"`：禁用群组消息

白名单配置示例：

```json5
{
  channels: {
    feishu: {
      groupPolicy: "allowlist",
      groupAllowFrom: ["ou_xxx", "ou_yyy"],
    },
  },
}
```

### 多账号管理

您可以管理多个飞书/Lark 机器人：

```json5
{
  channels: {
    feishu: {
      accounts: {
        main: {
          appId: "cli_xxx",
          appSecret: "xxx",
          botName: "主机器人",
        },
        backup: {
          appId: "cli_yyy",
          appSecret: "yyy",
          botName: "备用机器人",
          enabled: false,
        },
      },
    },
  },
}
```

---

## 故障排除

### 机器人在群组中不响应

1. 确保机器人已添加到群组
2. 确保您 @提及了机器人（默认行为）
3. 检查 `groupPolicy` 是否设置为 `"disabled"`
4. 查看日志：`openclaw logs --follow`

### 机器人收不到消息

1. 确保应用已发布并审批通过
2. 确保事件订阅包含 `im.message.receive_v1`
3. 确保启用了**长连接**（WebSocket）
4. 确保所有权限已授予
5. 确保网关正在运行：`openclaw gateway status`
6. 查看日志：`openclaw logs --follow`

### App Secret 泄露

1. 在飞书/Lark 开放平台重置 App Secret
2. 更新 OpenClaw 配置中的 App Secret
3. 重启网关：`openclaw gateway restart`

### 消息发送失败

1. 确保应用拥有 `im:message:send_as_bot` 权限
2. 确保应用已发布
3. 查看日志以获取详细错误信息

---

## 常用命令

| 命令      | 说明         |
| --------- | ------------ |
| `/status` | 显示机器人状态 |
| `/reset`  | 重置会话     |
| `/model`  | 显示/切换模型 |

---

## 支持的消息类型

**接收**：
- ✅ 文本
- ✅ 图片
- ✅ 文件
- ✅ 音频
- ✅ 视频
- ✅ 表情包

**发送**：
- ✅ 文本
- ✅ 图片
- ✅ 文件
- ✅ 音频
- ⚠️ 富文本（部分支持）

---

## 总结

您已成功将 OpenClaw 与飞书/Lark 集成！此设置使您的团队能够直接在企业消息平台中与 AI 交互，无论您使用的是中国版飞书还是国际版 Lark。

**关键要点**：
- 飞书和 Lark 使用相同的 API，仅域名不同
- WebSocket 模式无需公网 webhook URL
- 配对模式为企业使用提供安全的访问控制
- 完全支持私聊和群聊，具有灵活的策略

有关更多配置选项，请查看 [OpenClaw 官方文档](https://docs.openclaw.ai)。
