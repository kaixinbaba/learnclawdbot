---
title: "ä¿®å¤ï¼šLLM Request Rejected - Unexpected tool_use_id in tool_result Blocks"
description: "å¦‚ä½•é€šè¿‡æ¸…é™¤æŸåçš„ä¼šè¯æ–‡ä»¶æ¥è§£å†³ OpenClaw ä¸­ 'unexpected tool_use_id found in tool_result blocks' é”™è¯¯"
slug: /troubleshooting/fix-tool-use-id-error
tags: troubleshooting, error, session, fix
publishedAt: 2026-02-01
status: published
visibility: public
isPinned: false
featuredImageUrl: /images/features/fix_tool_use_id_head.webp
---

# ä¿®å¤ï¼šLLM Request Rejected â€” Unexpected tool_use_id in tool_result Blocks

å¦‚æœä½ åœ¨ä½¿ç”¨ OpenClaw æ—¶çªç„¶é‡åˆ°è¿™ä¸ªé”™è¯¯ï¼š

```
LLM request rejected: messages.58.content.1: unexpected tool_use_id found
in tool_result blocks: toolu_01BuEWGgvuHAY9iAXdbCpCEw.
Each tool_result block must have a corresponding tool_use block in the
previous message.
```

åˆ«æ…Œã€‚è¿™æ˜¯ä¸€ä¸ª**ä¼šè¯æ–‡ä»¶æŸå**çš„é—®é¢˜ï¼Œä¿®å¤èµ·æ¥å¾ˆç®€å•ã€‚

## é”™è¯¯åŸå› 

å½“ OpenClaw ä¸ LLMï¼ˆå¦‚ Claudeï¼‰é€šä¿¡æ—¶ï¼Œä¼šä»¥ä¸€ç³»åˆ—æ¶ˆæ¯çš„å½¢å¼å‘é€å¯¹è¯å†å²ã€‚æ¯ä¸ª `tool_result` å—å¿…é¡»å¼•ç”¨ä¸Šä¸€æ¡æ¶ˆæ¯ä¸­çš„ `tool_use` å—â€”â€”å®ƒä»¬æ˜¯æˆå¯¹å‡ºç°çš„ã€‚

å½“ä¼šè¯å†å²å¤±å»åŒæ­¥æ—¶å°±ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ï¼š

- **ä¼šè¯å‹ç¼©ï¼ˆCompactionï¼‰** åˆ é™¤äº† `tool_use` å—ä½†ä¿ç•™äº† `tool_result`
- è¿›ç¨‹åœ¨**å¯¹è¯ä¸­é€”è¢«ä¸­æ–­**ï¼ˆå´©æºƒã€å¼ºåˆ¶é€€å‡ºã€ç½‘ç»œè¶…æ—¶ï¼‰
- **æ‰‹åŠ¨ç¼–è¾‘**ä¼šè¯æ–‡ä»¶å¯¼è‡´æ¶ˆæ¯é“¾æ–­è£‚

LLM API ä¼šä¸¥æ ¼éªŒè¯æ¶ˆæ¯ç»“æ„ã€‚å¦‚æœå‘ç°ä¸€ä¸ª `tool_result` å¼•ç”¨äº†ä¸Šä¸€æ¡æ¶ˆæ¯ä¸­ä¸å­˜åœ¨çš„ `tool_use_id`ï¼Œå°±ä¼šæ‹’ç»æ•´ä¸ªè¯·æ±‚ã€‚

## ä¿®å¤æ–¹æ³•ï¼šåˆ é™¤æŸåçš„ä¼šè¯æ–‡ä»¶

### ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°ä¼šè¯ç›®å½•

OpenClaw å°†ä¼šè¯è®°å½•å­˜å‚¨ä¸º `.jsonl` æ–‡ä»¶ã€‚ä½ç½®å–å†³äºä½ çš„é…ç½®ï¼š

```bash
# macOS/Linux é»˜è®¤ä½ç½®
~/.openclaw/agents/main/sessions/

# æŸ¥çœ‹ä½ çš„å·¥ä½œåŒº
ls -lt ~/.openclaw/agents/main/sessions/*.jsonl | head -5
```

### ç¬¬äºŒæ­¥ï¼šè¯†åˆ«æŸåçš„æ–‡ä»¶

æœ€è¿‘ä¿®æ”¹çš„ `.jsonl` æ–‡ä»¶å¾ˆå¯èƒ½å°±æ˜¯é—®é¢˜æ‰€åœ¨ï¼š

```bash
# æŒ‰ä¿®æ”¹æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
ls -lt ~/.openclaw/agents/main/sessions/*.jsonl | head -5
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š

```
-rw-r--r--  1 user  staff  245632 Feb  1 12:30 abc123-def456.jsonl
-rw-r--r--  1 user  staff  189421 Feb  1 10:15 789ghi-012jkl.jsonl
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ é™¤æŸåçš„ä¼šè¯

```bash
# åˆ é™¤æœ€è¿‘çš„ä¼šè¯æ–‡ä»¶
rm ~/.openclaw/agents/main/sessions/<æŸåçš„æ–‡ä»¶>.jsonl
```

æˆ–è€…æ›´å®‰å…¨çš„åšæ³•ï¼š

```bash
# ç§»åŠ¨è€Œä¸æ˜¯åˆ é™¤
mv ~/.openclaw/agents/main/sessions/<æŸåçš„æ–‡ä»¶>.jsonl /tmp/
```

### ç¬¬å››æ­¥ï¼šé‡å¯ç½‘å…³ï¼ˆGatewayï¼‰

```bash
openclaw gateway restart
```

å°±è¿™æ ·ã€‚OpenClaw ä¼šå¼€å§‹ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œé”™è¯¯åº”è¯¥å°±æ¶ˆå¤±äº†ã€‚

## é¢„é˜²å»ºè®®

1. **ä¸è¦åœ¨å·¥å…·æ‰§è¡ŒæœŸé—´å¼ºåˆ¶é€€å‡º OpenClaw** â€” ç­‰å¾…å®Œæˆæˆ–ä½¿ç”¨ `/abort` å‘½ä»¤
2. **é¿å…æ‰‹åŠ¨ç¼–è¾‘ `.jsonl` æ–‡ä»¶** â€” è¿™äº›æ˜¯æœºå™¨ç”Ÿæˆçš„ä¼šè¯è®°å½•
3. **å®šæœŸé‡å¯ç½‘å…³** æœ‰åŠ©äºæ¸…é™¤è¿‡æœŸçš„ä¼šè¯çŠ¶æ€
4. å¦‚æœé¢‘ç¹é‡åˆ°å‹ç¼©é—®é¢˜ï¼Œè€ƒè™‘åœ¨ç½‘å…³é…ç½®ä¸­è°ƒæ•´ `compaction` è®¾ç½®

## ç†è§£é”™è¯¯ä¿¡æ¯

è®©æˆ‘ä»¬æ‹†è§£ä¸€ä¸‹è¿™ä¸ªé”™è¯¯ï¼š

| éƒ¨åˆ† | å«ä¹‰ |
|------|------|
| `messages.58.content.1` | ç¬¬ 59 æ¡æ¶ˆæ¯ï¼ˆä» 0 å¼€å§‹è®¡æ•°ï¼‰ï¼Œç¬¬ 2 ä¸ªå†…å®¹å— |
| `unexpected tool_use_id` | å‘ç°ä¸€ä¸ª tool_result å¼•ç”¨äº†ä¸å­˜åœ¨çš„ tool_use |
| `toolu_01BuEWGgvuHAY9iAXdbCpCEw` | å­¤ç«‹çš„å·¥å…·è°ƒç”¨ ID |
| `Each tool_result block must have a corresponding tool_use block` | API çš„éªŒè¯è§„åˆ™ |

## ç›¸å…³é—®é¢˜

- **"All models failed"** â€” å¯èƒ½æ˜¯å¦ä¸€ä¸ªé—®é¢˜ã€‚æ£€æŸ¥ä½ çš„ API å¯†é’¥å’Œæ¨¡å‹é…ç½®ã€‚
- **"Session too large"** â€” ä½ çš„ä¼šè¯å†å²å¯èƒ½å¤ªé•¿äº†ã€‚OpenClaw é€šè¿‡è‡ªåŠ¨å‹ç¼©æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚
- **ç½‘å…³æ— æ³•å¯åŠ¨** â€” å°è¯•è¿è¡Œ `openclaw doctor` æ¥è¯Šæ–­é—®é¢˜ã€‚

## æ€»ç»“

| é—®é¢˜ | æŸåçš„ä¼šè¯æ–‡ä»¶åŒ…å«å­¤ç«‹çš„ tool_result å— |
|------|----------------------------------------|
| åŸå›  | ä¼šè¯å‹ç¼©ã€å´©æºƒæˆ–å·¥å…·æ‰§è¡ŒæœŸé—´çš„ä¸­æ–­ |
| ä¿®å¤ | åˆ é™¤ sessions ç›®å½•ä¸­æœ€è¿‘çš„ `.jsonl` æ–‡ä»¶ |
| ä¿®å¤æ—¶é—´ | 30 ç§’ |
| é¢„é˜² | ä¸è¦åœ¨å·¥å…·æ‰§è¡ŒæœŸé—´å¼ºåˆ¶é€€å‡º |

è¿™æ˜¯é‚£ç§çœ‹èµ·æ¥å¾ˆå“äººä½†ä¿®å¤èµ·æ¥å¾ˆç®€å•çš„é”™è¯¯ã€‚å¦‚æœé‡åˆ°äº†ï¼Œæ¸…é™¤ä¼šè¯ç„¶åç»§ç»­å°±å¥½ã€‚Happy automating! ğŸš€
