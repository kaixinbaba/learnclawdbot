---
title: OpenClaw Discord 集成 - 角色、线程、论坛频道和权限设置完整指南
description: OpenClaw Discord 机器人集成完整指南。学习如何配置角色、权限、线程、论坛频道，并解决常见问题。
slug: /integrations/discord-setup
tags: discord, integration, bot, setup, permissions, threads, forum channels
publishedAt: 2026-02-13
status: published
visibility: public
featuredImageUrl: /images/blog/discord-integration.png
---

# OpenClaw Discord 集成：完整设置指南

Discord 是功能最强大的机器人集成平台之一，提供角色、权限、线程和论坛频道等丰富功能。将 OpenClaw 实例与 Discord 集成，可实现复杂的自动化、多服务器管理和高级权限控制，远超简单的消息传递。

本综合指南将引导您完成整个 **openclaw discord setup** 过程，从创建机器人和配置基本权限，到利用线程管理和论坛频道支持等高级功能。我们将介绍实际问题，包括影响线程创建的关键论坛频道陷阱（基于 GitHub Issue #6601）。

## 为什么选择 Discord + OpenClaw？

Discord 广泛的 API 和丰富的功能集使其成为 OpenClaw 集成的理想平台：

- **细粒度权限**：基于角色的访问控制，实现精细的安全性
- **丰富的组织结构**：服务器、分类、频道、线程和论坛
- **可扩展性**：处理多个服务器、数百个频道、数千用户
- **原生功能**：表情反应、嵌入、按钮、斜杠命令等
- **开发者友好**：优秀的文档和强大的 API

无论您是管理社区服务器、协调团队，还是构建自定义自动化工作流，**openclaw discord permissions** 和频道管理都能为您提供前所未有的控制力。

## 准备工作

在开始 **openclaw discord setup** 之前，请确保具备：

- **已安装并运行 OpenClaw** - 推荐 0.5.0 或更高版本
- **Discord 账号** - 具有创建机器人的权限
- **服务器管理员访问权限** - 至少在一个 Discord 服务器上用于测试
- **对 Discord 结构的基本了解** - 服务器、频道、角色
- **HTTPS 端点（可选）** - 仅在生产环境中使用 webhook 模式时需要

## 第一部分：创建 Discord 机器人

### 步骤 1：Discord 开发者门户设置

Discord 开发者门户是创建和管理机器人应用程序的地方。

**创建应用程序：**

1. 访问 [Discord 开发者门户](https://discord.com/developers/applications)
2. 点击 **"New Application"（新建应用程序）**
3. 输入名称（例如 "OpenClaw Assistant"）
4. 接受开发者服务条款
5. 点击 **"Create"（创建）**

**创建机器人用户：**

1. 在应用程序中，导航到 **"Bot"（机器人）** 选项卡
2. 点击 **"Add Bot"（添加机器人）**
3. 点击 **"Yes, do it!"（是的，继续）** 确认
4. 您的机器人现已创建

**获取机器人令牌：**

1. 在 Bot 选项卡中，找到 **"TOKEN"（令牌）** 部分
2. 点击 **"Reset Token"（重置令牌）**（如果是第一次，则点击 "Copy"（复制））
3. 复制令牌 - 这就是您的 `DISCORD_BOT_TOKEN`

**⚠️ 关键安全警告**：机器人令牌如同主密码。任何拥有此令牌的人都可以控制您的机器人。切勿将其提交到版本控制系统、公开分享或在截图中包含。使用环境变量或加密配置文件安全存储。

### 步骤 2：启用所需的 Intents

Discord 要求您明确启用某些机器人功能的"特权 intents"。

**为什么 Intents 很重要：**

Intents 控制您的机器人可以从 Discord 接收哪些事件。如果没有正确的 intents，您的机器人将成功连接但看不到消息或无法响应。

**OpenClaw 所需的 Intents：**

在 Bot 选项卡中，滚动到 **"Privileged Gateway Intents"（特权网关 Intents）** 并启用：

1. **✅ Server Members Intent（服务器成员 Intent）**
   - 用于：用户查找、允许列表匹配、成员信息
   - 如果没有：基于名称的允许列表将不起作用，成员查询将失败

2. **✅ Message Content Intent（消息内容 Intent）**
   - 用于：在服务器中读取消息文本
   - 如果没有：机器人连接但无法读取消息，看起来无响应
   - **这是"机器人不响应"问题的头号原因**

3. **❌ Presence Intent（在线状态 Intent）**（可选）
   - 仅在需要时使用：接收其他用户的在线状态更新
   - OpenClaw 基本功能不需要此项
   - 注意：设置机器人自己的状态（在线/离开/忙碌）不需要此 intent

**常见错误**：启用了机器人但忘记启用消息内容 Intent。这会导致机器人显示在线但从不响应消息。

### 步骤 3：配置机器人权限

Discord 的权限系统是细粒度的。您需要决定机器人可以做什么。

**建议的最小权限：**

对于基本的 **openclaw discord setup**，在 Bot 选项卡中启用这些权限：

- ✅ **View Channels（查看频道）** - 查看频道列表
- ✅ **Send Messages（发送消息）** - 回复用户
- ✅ **Read Message History（读取消息历史）** - 访问对话上下文
- ✅ **Embed Links（嵌入链接）** - 发送富嵌入
- ✅ **Attach Files（附加文件）** - 分享文件和图像
- ✅ **Add Reactions（添加反应）** - 对消息做出反应
- ✅ **Use External Emojis（使用外部表情）** - 使用其他服务器的自定义表情

**高级权限（可选）：**

对于高级功能，考虑：

- ✅ **Manage Messages（管理消息）** - 置顶、删除消息（需要信任）
- ✅ **Manage Channels（管理频道）** - 创建/编辑频道（用于自动化）
- ✅ **Manage Roles（管理角色）** - 分配角色（高信任级别）
- ✅ **Create Public Threads（创建公共线程）** - 在频道中启动线程
- ✅ **Create Private Threads（创建私密线程）** - 启动私密讨论
- ✅ **Manage Threads（管理线程）** - 归档、删除、管理线程
- ❌ **Administrator（管理员）** - 除非绝对必要，否则避免使用

**安全最佳实践**：仅授予您的用例实际需要的权限。您以后随时可以添加更多。最小权限原则可防止意外并限制令牌泄露时的损害。

### 步骤 4：生成邀请 URL

现在您将创建邀请链接以将机器人添加到服务器。

**使用 OAuth2 URL 生成器：**

1. 在应用程序中，导航到 **"OAuth2"** → **"URL Generator"（URL 生成器）**

2. 选择 **Scopes（作用域）**：
   - ✅ `bot` - 核心机器人功能
   - ✅ `applications.commands` - 斜杠命令支持

3. 选择 **Bot Permissions（机器人权限）**：
   - 勾选步骤 3 中确定的权限
   - URL 生成器将自动创建权限整数

4. **复制生成的 URL**（底部）

**邀请机器人：**

1. 在浏览器中打开生成的 URL
2. 选择要添加机器人的服务器
3. 审查权限（Discord 准确显示您要授予的内容）
4. 点击 **"Authorize"（授权）**
5. 如果提示，完成 CAPTCHA

您的机器人现在应该在服务器的成员列表中显示为离线状态。

## 第二部分：OpenClaw 配置

### 基本 Discord 配置

运行 **openclaw discord** 集成的最小配置。

**配置文件设置：**

编辑您的 OpenClaw 配置文件（通常是 `~/.openclaw/config.yaml` 或 `~/.openclaw/config.json`）：

```json
{
  "channels": {
    "discord": {
      "enabled": true,
      "token": "YOUR_BOT_TOKEN_HERE"
    }
  }
}
```

**使用环境变量（生产环境推荐）：**

不在配置中存储令牌，而是使用环境变量：

```bash
export DISCORD_BOT_TOKEN="YOUR_BOT_TOKEN_HERE"
```

然后您的配置可以简化为：

```json
{
  "channels": {
    "discord": {
      "enabled": true
    }
  }
}
```

OpenClaw 自动使用 `DISCORD_BOT_TOKEN` 环境变量作为后备。

**启动 OpenClaw：**

```bash
openclaw gateway start
```

在日志中查找 Discord 初始化：

```
[INFO] Discord channel enabled
[INFO] Discord: Connected as @YourBotName#1234
[INFO] Discord: Serving 1 guild(s)
```

### 理解访问控制

OpenClaw 通过两个主要策略为 Discord 集成提供复杂的访问控制：DM 策略和群组（服务器）策略。

**DM 策略选项：**

控制谁可以向您的机器人发送直接消息。

```json
{
  "channels": {
    "discord": {
      "dm": {
        "policy": "pairing",  // 推荐默认值
        "enabled": true
      }
    }
  }
}
```

**可用的 DM 策略：**

1. **`pairing`**（推荐）
   - 首次用户必须完成配对过程
   - 配对后，用户可以自由聊天
   - 配对代码 1 小时后过期
   - 批准方式：`openclaw pairing approve discord <code>`

2. **`allowlist`**
   - 只有预先批准的用户可以 DM 机器人
   - 需要明确的 `allowFrom` 列表
   - 最严格的安全模型

3. **`open`**
   - 任何人都可以 DM 机器人
   - 需要设置 `"allowFrom": ["*"]`
   - 在生产环境中谨慎使用

4. **`disabled`**
   - 完全禁用 DM 功能
   - 机器人将忽略所有直接消息

**群组/服务器策略选项：**

控制机器人在 Discord 服务器（guild）中的行为。

```json
{
  "channels": {
    "discord": {
      "groupPolicy": "allowlist"  // 默认值
    }
  }
}
```

**可用的群组策略：**

1. **`allowlist`**（默认）
   - 需要为每个服务器/频道明确配置
   - 生产环境最安全的选项
   - 除非特别配置，否则不响应

2. **`open`**
   - 机器人在添加到的任何服务器中响应
   - 适合测试，生产环境有风险
   - 可能导致意外交互

3. **`disabled`**
   - 机器人忽略所有服务器消息
   - 仅 DM 模式

### 允许列表配置

对于生产部署，配置明确的允许列表以控制访问。

**用户允许列表（DM）：**

```json
{
  "channels": {
    "discord": {
      "dm": {
        "policy": "allowlist",
        "allowFrom": [
          "123456789012345678",  // 用户 ID（推荐）
          "steipete",            // 用户名（启动时解析）
          "<@987654321098765432>"  // 提及格式
        ]
      }
    }
  }
}
```

**查找您的 Discord 用户 ID：**

1. 启用开发者模式：用户设置 → 高级 → 开发者模式
2. 在任何地方右键单击您的用户名 → 复制用户 ID
3. 在配置中使用此数字 ID

**服务器允许列表：**

```json
{
  "channels": {
    "discord": {
      "groupPolicy": "allowlist",
      "guilds": {
        "123456789012345678": {  // 服务器 ID（数字）
          "slug": "my-awesome-server",  // 可选的友好名称
          "users": [
            "987654321098765432",  // 此服务器中允许的用户
            "steipete"
          ],
          "requireMention": true  // 仅在 @提及时响应
        }
      }
    }
  }
}
```

**查找服务器和频道 ID：**

1. 启用开发者模式（同上）
2. 右键单击服务器名称 → 复制服务器 ID（guild ID）
3. 右键单击频道名称 → 复制频道 ID

## 第三部分：角色和权限配置

Discord 最强大的功能之一是其基于角色的权限系统。OpenClaw 可以利用此功能实现复杂的访问控制。

### 每个频道的配置

为同一服务器内的不同频道配置不同的行为。

**示例：多频道设置**

```json
{
  "channels": {
    "discord": {
      "guilds": {
        "123456789012345678": {
          "slug": "my-server",
          "requireMention": true,  // 所有频道的默认值
          "users": ["987654321098765432"],  // 服务器范围的允许列表
          
          "channels": {
            "general": {
              "allow": true,
              "requireMention": false  // 覆盖：不需要提及
            },
            
            "help": {
              "allow": true,
              "requireMention": true,
              "users": ["111111111111111111"],  // 频道特定的允许列表
              "systemPrompt": "保持回答简短且对初学者友好。"
            },
            
            "admin": {
              "allow": true,
              "users": ["987654321098765432"],  // 受限频道
              "skills": ["ssh", "exec", "filesystem"],  // 启用强大的工具
              "systemPrompt": "您拥有完全的系统访问权限。请小心。"
            }
          }
        }
      }
    }
  }
}
```

**频道配置选项：**

- **`allow`**: `true`/`false` - 机器人是否在此频道响应
- **`requireMention`**: 机器人仅在 @提及时响应
- **`users`**: 频道特定的用户允许列表（覆盖服务器级别）
- **`skills`**: 限制哪些 OpenClaw 技能可用
- **`systemPrompt`**: 频道特定的 AI 指令
- **`enabled`**: 完全禁用频道

**通配符频道配置：**

将默认设置应用于所有频道：

```json
{
  "guilds": {
    "123456789012345678": {
      "channels": {
        "*": {  // 应用于所有频道，除非被覆盖
          "requireMention": true,
          "allow": true
        },
        "admin": {  // 管理频道的特定覆盖
          "requireMention": false
        }
      }
    }
  }
}
```

### 工具和操作权限

通过操作门控制 AI 在 Discord 上可以做什么。

**默认操作权限：**

```json
{
  "channels": {
    "discord": {
      "actions": {
        "reactions": true,        // 对消息做出反应
        "stickers": true,         // 发送贴纸
        "emojiUploads": true,     // 上传自定义表情
        "stickerUploads": true,   // 上传自定义贴纸
        "polls": true,            // 创建投票
        "permissions": true,      // 查询频道权限
        "messages": true,         // 读取/发送/编辑/删除消息
        "threads": true,          // 创建/管理线程
        "pins": true,             // 置顶/取消置顶消息
        "search": true,           // 搜索消息历史
        "memberInfo": true,       // 查询成员信息
        "roleInfo": true,         // 查询角色信息
        "channelInfo": true,      // 查询频道信息
        "channels": true,         // 创建/编辑/删除频道
        "voiceStatus": true,      // 查询语音状态
        "events": true,           // 创建/管理事件
        
        // 高信任操作（默认禁用）
        "roles": false,           // 添加/移除角色
        "moderation": false,      // 超时/踢出/封禁用户
        "presence": false         // 更改机器人状态
      }
    }
  }
}
```

**每个服务器的工具覆盖：**

```json
{
  "guilds": {
    "123456789012345678": {
      "tools": {
        "allow": ["read", "write", "search"],  // 仅这些工具
        "deny": ["exec", "ssh"]  // 明确拒绝这些
      },
      
      "channels": {
        "admin": {
          "tools": {
            "alsoAllow": ["exec", "ssh"]  // 仅为此频道添加工具
          }
        }
      }
    }
  }
}
```

**每个发送者的工具策略：**

为不同用户授予不同的权限：

```json
{
  "guilds": {
    "123456789012345678": {
      "toolsBySender": {
        "987654321098765432": {  // 特定用户 ID
          "allow": "*"  // 完全访问所有工具
        },
        "*": {  // 其他所有人
          "allow": ["search", "web_search", "read"]
        }
      }
    }
  }
}
```

## 第四部分：线程和论坛频道支持

Discord 的线程和论坛功能支持有组织的、基于主题的讨论。OpenClaw 支持这些高级功能，但有一些重要的注意事项。

### 理解 Discord 的线程类型

Discord 有三种类型的线程：

1. **公共线程**：在文本频道中创建，对所有人可见
2. **私密线程**：文本频道中仅限邀请的线程
3. **论坛线程**：论坛频道中的帖子（特殊情况！）

### 基本线程配置

启用线程创建和管理：

```json
{
  "channels": {
    "discord": {
      "actions": {
        "threads": true  // 启用线程操作
      }
    }
  }
}
```

**通过 CLI 创建线程：**

```bash
# 在文本频道中创建线程
openclaw message thread-create \
  --channel discord \
  --target channel:123456789012345678 \
  --thread-name "讨论主题" \
  --message-id 987654321098765432  # 可选：从现有消息创建线程
```

**通过 Agent 创建线程：**

OpenClaw AI agent 可以在适当的时候创建线程：

```
用户：在支持频道中创建一个名为"错误报告"的线程
Agent：我将为您创建该线程。
[Agent 使用 thread-create 操作调用 discord 工具]
Agent：线程已创建！您可以在支持频道中找到它。
```

### 论坛频道支持（关键陷阱！）

论坛频道是 Discord 引入的一种特殊类型的频道。它们的工作方式与常规文本频道不同，需要特殊处理。

**什么是论坛频道？**

论坛频道将帖子显示为线程列表。每个帖子实际上都是一个有自己消息的线程。可以把它想象成 Discord 中内置的传统论坛（Reddit 风格）。

**论坛频道陷阱（GitHub Issue #6601）：**

尝试使用标准 `thread-create` 操作在论坛频道中创建线程时，您可能会遇到：

```
错误：无法在论坛频道中创建线程
```

或

```
错误：线程创建的频道类型无效
```

**为什么会发生这种情况：**

论坛频道不支持标准的 `createThread` API 端点。相反，您必须使用 `startThreadInForumChannel`，它具有不同的签名和要求。

**创建论坛帖子的正确方法：**

**方法 1：使用专用的论坛操作**

```bash
openclaw message thread-create \
  --channel discord \
  --target channel:123456789012345678 \  # 论坛频道 ID
  --thread-name "帖子标题" \
  --message "首条消息内容"  # 论坛帖子必需！
```

**关键区别**：论坛帖子**需要**初始消息。常规线程可以为空。

**方法 2：Agent 感知配置**

确保您的 OpenClaw agent 了解论坛频道：

```json
{
  "guilds": {
    "123456789012345678": {
      "channels": {
        "bug-reports": {  // 这是一个论坛频道
          "allow": true,
          "systemPrompt": "这是一个论坛频道。在这里创建帖子时，始终包含描述主题的初始消息。"
        }
      }
    }
  }
}
```

**方法 3：预检频道类型检查**

在尝试创建线程之前，agent 可以检查频道类型：

```bash
openclaw message channel-info --channel discord --target channel:123456789012345678
```

响应包括论坛频道的 `"type": 15`（相对于文本频道的 `"type": 0`）。

**论坛特定配置：**

```json
{
  "channels": {
    "discord": {
      "guilds": {
        "123456789012345678": {
          "channels": {
            "forum-channel-id": {
              "allow": true,
              "requireMention": false,  // 论坛帖子不需要提及
              "systemPrompt": "这是一个论坛频道。创建具有描述性标题和初始消息的帖子。每个帖子都成为一个线程。"
            }
          }
        }
      }
    }
  }
}
```

### 线程继承

线程自动从其父频道继承配置：

```json
{
  "channels": {
    "help": {
      "allow": true,
      "requireMention": true,
      "skills": ["search", "docs"],
      "systemPrompt": "提供帮助且简洁。"
    }
  }
}
```

在 `#help` 中创建的所有线程将具有：
- 提及要求
- 仅访问搜索和文档技能
- 相同的系统提示

**覆盖线程设置：**

您可以通过线程 ID 明确配置单个线程：

```json
{
  "channels": {
    "123456789012345678": {  // 特定线程 ID
      "requireMention": false,  // 覆盖父频道
      "systemPrompt": "此线程用于 X。专注于 Y。"
    }
  }
}
```

### 列出和管理线程

**列出所有活动线程：**

```bash
openclaw message thread-list \
  --channel discord \
  --guild-id 123456789012345678
```

**包含已归档的线程：**

```bash
openclaw message thread-list \
  --channel discord \
  --guild-id 123456789012345678 \
  --include-archived
```

**回复线程：**

```bash
openclaw message thread-reply \
  --channel discord \
  --target 987654321098765432 \  # 线程 ID
  --message "回复消息"
```

## 第五部分：高级多服务器设置

使用不同配置管理多个 Discord 服务器。

### 多服务器配置示例

```json
{
  "channels": {
    "discord": {
      "groupPolicy": "allowlist",
      
      "guilds": {
        "111111111111111111": {
          "slug": "personal-server",
          "requireMention": false,
          "users": ["987654321098765432"],
          "channels": {
            "*": { "allow": true }
          }
        },
        
        "222222222222222222": {
          "slug": "work-team",
          "requireMention": true,
          "users": ["987654321098765432", "111111111111111111"],
          "channels": {
            "general": { 
              "allow": true,
              "requireMention": false 
            },
            "support": {
              "allow": true,
              "systemPrompt": "您是一个有用的支持助手。保持回复专业。"
            }
          }
        },
        
        "333333333333333333": {
          "slug": "community-server",
          "requireMention": true,
          "reactionNotifications": "own",  // 仅通知机器人消息的反应
          "channels": {
            "bot-commands": {
              "allow": true,
              "requireMention": false,
              "skills": ["search", "web_search", "weather"]  // 有限的公共技能
            }
          }
        }
      }
    }
  }
}
```

### 使用 Slug 与 ID

OpenClaw 支持数字 ID 和友好的 slug。

**用于可读性的 Slug：**

```json
{
  "guilds": {
    "my-awesome-server": {  // Slug（自动生成：小写、破折号）
      "channels": {
        "general": { "allow": true },
        "help": { "allow": true }
      }
    }
  }
}
```

**用于可靠性的 ID：**

```json
{
  "guilds": {
    "123456789012345678": {  // 数字 ID（推荐）
      "slug": "my-awesome-server",  // 可选的友好引用
      "channels": {
        "987654321098765432": { "allow": true }  // 频道 ID
      }
    }
  }
}
```

**最佳实践**：在生产配置中使用 ID（它们永不更改），在注释或文档中使用 slug 以提高可读性。

### 多账户支持

从一个 OpenClaw 实例运行多个机器人账户：

```json
{
  "channels": {
    "discord": {
      "accounts": [
        {
          "name": "personal-bot",
          "token": "PERSONAL_BOT_TOKEN",
          "dm": {
            "policy": "pairing"
          }
        },
        {
          "name": "work-bot",
          "token": "WORK_BOT_TOKEN",
          "groupPolicy": "allowlist",
          "guilds": {
            "222222222222222222": {
              "channels": {
                "*": { "allow": true }
              }
            }
          }
        }
      ]
    }
  }
}
```

## 第六部分：常见问题和故障排除

### 问题 1：机器人不响应消息

**基于社区报告和 GitHub 问题**

**症状：**
- 机器人在 Discord 中显示在线
- `openclaw status` 显示 Discord 已连接
- 机器人从不响应服务器频道中的消息

**诊断步骤：**

1. **检查消息内容 Intent：**
```bash
# 访问 Discord 开发者门户 → 您的应用 → 机器人 → 特权网关 Intents
# 确保"消息内容 Intent"已启用
```

如果未启用，启用它并重启 OpenClaw：
```bash
openclaw gateway restart
```

2. **验证频道权限：**
```bash
openclaw message permissions --channel discord --target channel:YOUR_CHANNEL_ID
```

确保机器人具有：
- 查看频道
- 发送消息
- 读取消息历史

3. **检查 OpenClaw 配置：**
```bash
openclaw config get channels.discord.groupPolicy
```

如果是 `allowlist`，确保服务器/频道已配置：
```bash
openclaw config get channels.discord.guilds
```

4. **使用直接提及测试：**

在 Discord 中尝试：`@YourBot 你好`

如果这有效但正常消息无效，您的配置有 `requireMention: true`。

**解决方案：**

**解决方案 A**：启用消息内容 Intent（最常见的修复）
**解决方案 B**：将服务器/频道添加到允许列表
**解决方案 C**：禁用提及要求（如果需要）
**解决方案 D**：检查 Discord 服务器设置中的机器人角色权限

### 问题 2：在论坛频道中创建线程失败

**基于 GitHub Issue #6601**

**症状：**
- `thread-create` 在普通文本频道中有效
- 在论坛频道中失败，显示"频道类型无效"错误
- **openclaw discord forum channels** 搜索将您带到这里

**解决方案：**

论坛频道需要不同的方法。有关详细信息，请参阅上面的论坛频道部分。

**快速修复：**

```bash
# 创建论坛帖子时包含消息
openclaw message thread-create \
  --channel discord \
  --target channel:FORUM_CHANNEL_ID \
  --thread-name "帖子标题" \
  --message "初始帖子内容"  # 这是必需的！
```

### 问题 3：权限被拒绝错误

**症状：**
- 机器人具有正确的 intents
- 频道出现在允许列表中
- 仍然收到"未授权"错误

**诊断步骤：**

1. **检查用户允许列表：**
```bash
openclaw config get channels.discord.guilds.GUILD_ID.users
```

2. **验证用户 ID：**
```bash
# 让用户发送消息，然后检查日志：
openclaw gateway logs | grep "Discord message from"
```

3. **检查频道特定的允许列表：**
```bash
openclaw config get channels.discord.guilds.GUILD_ID.channels.CHANNEL.users
```

**解决方案：**

**解决方案 A**：将用户添加到服务器级别的允许列表
**解决方案 B**：将用户添加到频道级别的允许列表
**解决方案 C**：将策略更改为 `open` 进行测试（不建议用于生产）

### 问题 4：反应不起作用

**症状：**
- 机器人可以发送消息
- 无法添加反应
- 反应命令默默失败

**诊断步骤：**

1. **检查反应权限：**
```bash
openclaw config get channels.discord.actions.reactions
```

应该是 `true`。

2. **检查机器人 Discord 权限：**
- 服务器设置 → 角色 → 您的机器人角色
- 确保"添加反应"已启用

3. **检查表情格式：**
```bash
# Unicode 表情（应该在任何地方都有效）
openclaw message react --channel discord --target channel:ID --message-id ID --emoji "✅"

# 自定义表情（服务器特定）
openclaw message react --channel discord --target channel:ID --message-id ID --emoji "<:name:123456789>"
```

**解决方案：**

**解决方案 A**：在 OpenClaw 配置中启用反应
**解决方案 B**：在 Discord 中授予"添加反应"权限
**解决方案 C**：使用正确的表情格式（unicode vs 自定义）

### 问题 5：斜杠命令未出现

**症状：**
- 机器人成功连接
- 输入 `/` 不显示机器人命令
- 命令之前有效但现在消失了

**诊断步骤：**

1. **检查 OAuth2 作用域：**
- 您是否使用 `applications.commands` 作用域邀请机器人？
- 如果没有，您需要使用更新的作用域重新邀请

2. **检查命令注册：**
```bash
openclaw config get channels.discord.commands.native
```

应该是 `true` 或 `"auto"`。

3. **强制命令同步：**
```bash
openclaw gateway restart
# 命令在启动时重新注册
```

**解决方案：**

**解决方案 A**：使用 `applications.commands` 作用域重新邀请机器人
**解决方案 B**：在配置中启用原生命令
**解决方案 C**：等待最多 1 小时让 Discord 在全球范围内传播命令
**解决方案 D**：重启 OpenClaw 网关以强制重新注册

## 安全最佳实践

### 1. 令牌安全

**应该做：**
- ✅ 使用环境变量存储令牌
- ✅ 将令牌存储在加密保险库中（AWS Secrets Manager、HashiCorp Vault）
- ✅ 定期轮换令牌
- ✅ 开发和生产使用不同的令牌

**不应该做：**
- ❌ 将令牌提交到 git
- ❌ 在截图或日志中分享令牌
- ❌ 在多个项目中使用相同的令牌
- ❌ 在共享位置的明文配置文件中存储令牌

### 2. 最小权限原则

**机器人权限：**
只授予所需的权限。从最小开始，根据需要添加。

**用户允许列表：**
明确说明谁可以使用机器人：

```json
{
  "dm": {
    "policy": "allowlist",
    "allowFrom": ["YOUR_USER_ID"]  // 从仅您开始
  }
}
```

**工具限制：**
在公共频道中限制危险工具：

```json
{
  "channels": {
    "public-bot-commands": {
      "tools": {
        "allow": ["search", "weather", "web_search"],
        "deny": ["exec", "ssh", "filesystem"]
      }
    }
  }
}
```

### 3. 审计和监控

**日志审查：**
```bash
# 审查谁在使用机器人
openclaw gateway logs | grep "Discord message from" | tail -50

# 检查失败的授权尝试
openclaw gateway logs | grep "not authorized"
```

**定期配置审计：**
```bash
# 审查当前的允许列表
openclaw config get channels.discord.guilds

# 检查启用的操作
openclaw config get channels.discord.actions
```

### 4. Webhook 安全

如果使用 webhook（高级主题，此处未详细介绍）：

```json
{
  "webhook": {
    "enabled": true,
    "url": "https://your-domain.com/discord/webhook",
    "secretToken": "use-a-long-random-secret"  // 必需
  }
}
```

生成强密钥：
```bash
openssl rand -hex 32
```

### 5. 速率限制和滥用预防

OpenClaw 包含内置的速率限制处理：

```json
{
  "retry": {
    "attempts": 3,
    "minDelayMs": 500,
    "maxDelayMs": 30000,
    "jitter": 0.1
  }
}
```

这可以保护您的机器人免受 Discord 的速率限制并防止暂时封禁。

## 相关资源

- **[OpenClaw 初学者指南](/blog/guide)** - 如果您是 OpenClaw 新手，请从这里开始
- **[Telegram 设置指南](/blog/integrations/telegram-setup)** - 替代消息平台
- **[修复会话内存问题](/blog/troubleshooting/fix-session-memory-issues)** - 故障排除指南
- **[Discord 机器人官方文档](https://discord.com/developers/docs)** - 深入了解 Discord API
- **[OpenClaw Discord 频道文档](https://docs.openclaw.org/channels/discord)** - 官方技术参考
- **[GitHub Issues: discord 标签](https://github.com/openclaw/openclaw/issues?q=label%3Adiscord)** - 社区报告的问题

## 总结

本指南涵盖了全面的 **openclaw discord setup**，包括：

✅ **机器人创建**：开发者门户设置、intents、权限
✅ **基本配置**：令牌管理、访问控制策略
✅ **角色和权限**：服务器级别、频道级别、用户级别的允许列表
✅ **线程和论坛**：标准线程、论坛频道和关键的论坛陷阱
✅ **多服务器设置**：使用不同配置管理多个服务器
✅ **故障排除**：常见问题的实际解决方案
✅ **安全性**：生产部署的最佳实践

**关键要点：**

1. **消息内容 Intent 至关重要** - "机器人不响应"的头号原因
2. **论坛频道需要特殊处理** - 包含消息内容
3. **从允许列表策略开始** - 根据需要逐渐开放
4. **在生产配置中使用 ID** - Slug 用于文档
5. **授予最小权限** - 仅在必要时添加更多

无论您是为小团队设置 **openclaw discord permissions**，还是在大型社区中管理 **openclaw discord forum channels**，本指南都为健壮、安全的 Discord 集成提供了基础。

祝您使用 OpenClaw 在 Discord 上愉快！🤖💬
