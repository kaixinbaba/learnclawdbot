---
summary: "Hooksï¼šé’ˆå¯¹å‘½ä»¤å’Œç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„äº‹ä»¶é©±åŠ¨è‡ªåŠ¨åŒ–"
read_when:
  - æ‚¨æƒ³ä¸º /newã€/resetã€/stop å’Œ agent ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å®ç°äº‹ä»¶é©±åŠ¨è‡ªåŠ¨åŒ–
  - æ‚¨æƒ³æ„å»ºã€å®‰è£…æˆ–è°ƒè¯• hooks
---
# Hooksï¼ˆé’©å­ï¼‰

Hooks æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„äº‹ä»¶é©±åŠ¨ç³»ç»Ÿï¼Œç”¨äºè‡ªåŠ¨åŒ–å“åº” agent å‘½ä»¤å’Œäº‹ä»¶çš„æ“ä½œã€‚Hooks ä¼šè‡ªåŠ¨ä»ç›®å½•ä¸­å‘ç°ï¼Œå¹¶å¯ä»¥é€šè¿‡ CLI å‘½ä»¤è¿›è¡Œç®¡ç†ï¼Œç±»ä¼¼äº OpenClaw ä¸­ skillsï¼ˆæŠ€èƒ½ï¼‰çš„å·¥ä½œæ–¹å¼ã€‚

## å…¥é—¨æŒ‡å—

Hooks æ˜¯åœ¨æŸäº›äº‹æƒ…å‘ç”Ÿæ—¶è¿è¡Œçš„å°è„šæœ¬ã€‚æœ‰ä¸¤ç§ç±»å‹ï¼š

- **Hooks**ï¼ˆæœ¬é¡µï¼‰ï¼šåœ¨ agent äº‹ä»¶è§¦å‘æ—¶åœ¨ Gateway å†…è¿è¡Œï¼Œå¦‚ `/new`ã€`/reset`ã€`/stop` æˆ–ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚
- **Webhooks**ï¼šå¤–éƒ¨ HTTP webhooksï¼Œè®©å…¶ä»–ç³»ç»Ÿåœ¨ OpenClaw ä¸­è§¦å‘å·¥ä½œã€‚å‚è§ [Webhook Hooks](/automation/webhook) æˆ–ä½¿ç”¨ `openclaw webhooks` è·å– Gmail åŠ©æ‰‹å‘½ä»¤ã€‚
  
Hooks ä¹Ÿå¯ä»¥æ†ç»‘åœ¨ pluginsï¼ˆæ’ä»¶ï¼‰å†…ï¼›å‚è§ [Plugins](/plugin#plugin-hooks)ã€‚

å¸¸è§ç”¨é€”ï¼š
- åœ¨é‡ç½® sessionï¼ˆä¼šè¯ï¼‰æ—¶ä¿å­˜ memoryï¼ˆå†…å­˜ï¼‰å¿«ç…§
- ä¿ç•™å‘½ä»¤çš„å®¡è®¡è·Ÿè¸ªä»¥è¿›è¡Œæ•…éšœæ’æŸ¥æˆ–åˆè§„
- åœ¨ session å¼€å§‹æˆ–ç»“æŸæ—¶è§¦å‘åç»­è‡ªåŠ¨åŒ–
- åœ¨äº‹ä»¶è§¦å‘æ—¶å°†æ–‡ä»¶å†™å…¥ agent workspaceï¼ˆå·¥ä½œåŒºï¼‰æˆ–è°ƒç”¨å¤–éƒ¨ APIs

å¦‚æœæ‚¨ä¼šç¼–å†™å°å‹ TypeScript å‡½æ•°ï¼Œæ‚¨å°±å¯ä»¥ç¼–å†™ hookã€‚Hooks ä¼šè‡ªåŠ¨å‘ç°ï¼Œæ‚¨å¯ä»¥é€šè¿‡ CLI å¯ç”¨æˆ–ç¦ç”¨å®ƒä»¬ã€‚

## æ¦‚è¿°

Hooks ç³»ç»Ÿå…è®¸æ‚¨ï¼š
- åœ¨å‘å‡º `/new` æ—¶å°† session contextï¼ˆä¼šè¯ä¸Šä¸‹æ–‡ï¼‰ä¿å­˜åˆ° memory
- è®°å½•æ‰€æœ‰å‘½ä»¤ä»¥è¿›è¡Œå®¡è®¡
- åœ¨ agent ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¸Šè§¦å‘è‡ªå®šä¹‰è‡ªåŠ¨åŒ–
- åœ¨ä¸ä¿®æ”¹æ ¸å¿ƒä»£ç çš„æƒ…å†µä¸‹æ‰©å±• OpenClaw çš„è¡Œä¸º

## å¼€å§‹ä½¿ç”¨

### æ†ç»‘çš„ Hooks

OpenClaw é™„å¸¦å››ä¸ªè‡ªåŠ¨å‘ç°çš„æ†ç»‘ hooksï¼š

- **ğŸ’¾ session-memory**ï¼šåœ¨æ‚¨å‘å‡º `/new` æ—¶å°† session context ä¿å­˜åˆ°æ‚¨çš„ agent workspaceï¼ˆé»˜è®¤ `~/.openclaw/workspace/memory/`ï¼‰
- **ğŸ“ command-logger**ï¼šå°†æ‰€æœ‰å‘½ä»¤äº‹ä»¶è®°å½•åˆ° `~/.openclaw/logs/commands.log`
- **ğŸš€ boot-md**ï¼šåœ¨ gateway å¯åŠ¨æ—¶è¿è¡Œ `BOOT.md`ï¼ˆéœ€è¦å¯ç”¨å†…éƒ¨ hooksï¼‰
- **ğŸ˜ˆ soul-evil**ï¼šåœ¨æ¸…é™¤çª—å£æœŸé—´æˆ–éšæœºæƒ…å†µä¸‹å°†æ³¨å…¥çš„ `SOUL.md` å†…å®¹ä¸ `SOUL_EVIL.md` äº¤æ¢

åˆ—å‡ºå¯ç”¨çš„ hooksï¼š

```bash
openclaw hooks list
```

å¯ç”¨ hookï¼š

```bash
openclaw hooks enable session-memory
```

æ£€æŸ¥ hook çŠ¶æ€ï¼š

```bash
openclaw hooks check
```

è·å–è¯¦ç»†ä¿¡æ¯ï¼š

```bash
openclaw hooks info session-memory
```

### Onboardingï¼ˆå…¥é—¨å¼•å¯¼ï¼‰

åœ¨ onboardingï¼ˆ`openclaw onboard`ï¼‰æœŸé—´ï¼Œç³»ç»Ÿä¼šæç¤ºæ‚¨å¯ç”¨æ¨èçš„ hooksã€‚å‘å¯¼ä¼šè‡ªåŠ¨å‘ç°ç¬¦åˆæ¡ä»¶çš„ hooks å¹¶æä¾›é€‰æ‹©ã€‚

## Hook Discoveryï¼ˆå‘ç°ï¼‰

Hooks ä¼šè‡ªåŠ¨ä»ä¸‰ä¸ªç›®å½•å‘ç°ï¼ˆæŒ‰ä¼˜å…ˆçº§é¡ºåºï¼‰ï¼š

1. **Workspace hooks**ï¼š`<workspace>/hooks/`ï¼ˆæ¯ä¸ª agentï¼Œæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. **Managed hooks**ï¼š`~/.openclaw/hooks/`ï¼ˆç”¨æˆ·å®‰è£…ï¼Œè·¨ workspaces å…±äº«ï¼‰
3. **Bundled hooks**ï¼š`<openclaw>/dist/hooks/bundled/`ï¼ˆOpenClaw é™„å¸¦ï¼‰

Managed hook ç›®å½•å¯ä»¥æ˜¯ **å•ä¸ª hook** æˆ– **hook packï¼ˆé’©å­åŒ…ï¼‰**ï¼ˆpackageï¼ˆåŒ…ï¼‰ç›®å½•ï¼‰ã€‚

æ¯ä¸ª hook æ˜¯ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„ç›®å½•ï¼š

```
my-hook/
â”œâ”€â”€ HOOK.md          # Metadataï¼ˆå…ƒæ•°æ®ï¼‰+ æ–‡æ¡£
â””â”€â”€ handler.ts       # Handlerï¼ˆå¤„ç†å™¨ï¼‰å®ç°
```

## Hook Packs (npm/archives)

Hook packs æ˜¯æ ‡å‡†çš„ npm packagesï¼Œé€šè¿‡ `package.json` ä¸­çš„ `openclaw.hooks` å¯¼å‡ºä¸€ä¸ªæˆ–å¤šä¸ª hooksã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š

```bash
openclaw hooks install <path-or-spec>
```

ç¤ºä¾‹ `package.json`ï¼š

```json
{
  "name": "@acme/my-hooks",
  "version": "0.1.0",
  "openclaw": {
    "hooks": ["./hooks/my-hook", "./hooks/other-hook"]
  }
}
```

æ¯ä¸ªæ¡ç›®æŒ‡å‘ä¸€ä¸ªåŒ…å« `HOOK.md` å’Œ `handler.ts`ï¼ˆæˆ– `index.ts`ï¼‰çš„ hook ç›®å½•ã€‚
Hook packs å¯ä»¥é™„å¸¦ä¾èµ–é¡¹ï¼›å®ƒä»¬å°†å®‰è£…åœ¨ `~/.openclaw/hooks/<id>` ä¸‹ã€‚

## Hook Structureï¼ˆç»“æ„ï¼‰

### HOOK.md æ ¼å¼

`HOOK.md` æ–‡ä»¶åœ¨ YAML frontmatter ä¸­åŒ…å« metadata ä»¥åŠ Markdown æ–‡æ¡£ï¼š

```markdown
---
name: my-hook
description: "å¯¹è¿™ä¸ª hook åŠŸèƒ½çš„ç®€çŸ­æè¿°"
homepage: https://docs.openclaw.ai/hooks#my-hook
metadata: {"openclaw":{"emoji":"ğŸ”—","events":["command:new"],"requires":{"bins":["node"]}}}
---

# My Hook

è¯¦ç»†æ–‡æ¡£åœ¨è¿™é‡Œ...

## What It Does

- ç›‘å¬ `/new` å‘½ä»¤
- æ‰§è¡ŒæŸäº›æ“ä½œ
- è®°å½•ç»“æœ

## Requirements

- å¿…é¡»å®‰è£… Node.js

## Configuration

æ— éœ€é…ç½®ã€‚
```

### Metadata å­—æ®µ

`metadata.openclaw` å¯¹è±¡æ”¯æŒï¼š

- **`emoji`**ï¼šCLI çš„æ˜¾ç¤º emojiï¼ˆä¾‹å¦‚ `"ğŸ’¾"`ï¼‰
- **`events`**ï¼šè¦ç›‘å¬çš„äº‹ä»¶æ•°ç»„ï¼ˆä¾‹å¦‚ `["command:new", "command:reset"]`ï¼‰
- **`export`**ï¼šè¦ä½¿ç”¨çš„å‘½åå¯¼å‡ºï¼ˆé»˜è®¤ä¸º `"default"`ï¼‰
- **`homepage`**ï¼šæ–‡æ¡£ URL
- **`requires`**ï¼šå¯é€‰è¦æ±‚
  - **`bins`**ï¼šPATH ä¸Šæ‰€éœ€çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¾‹å¦‚ `["git", "node"]`ï¼‰
  - **`anyBins`**ï¼šå¿…é¡»å­˜åœ¨è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„è‡³å°‘ä¸€ä¸ª
  - **`env`**ï¼šæ‰€éœ€çš„ç¯å¢ƒå˜é‡
  - **`config`**ï¼šæ‰€éœ€çš„é…ç½®è·¯å¾„ï¼ˆä¾‹å¦‚ `["workspace.dir"]`ï¼‰
  - **`os`**ï¼šæ‰€éœ€å¹³å°ï¼ˆä¾‹å¦‚ `["darwin", "linux"]`ï¼‰
- **`always`**ï¼šç»•è¿‡èµ„æ ¼æ£€æŸ¥ï¼ˆbooleanï¼ˆå¸ƒå°”å€¼ï¼‰ï¼‰
- **`install`**ï¼šå®‰è£…æ–¹æ³•ï¼ˆå¯¹äºæ†ç»‘ hooksï¼š`[{"id":"bundled","kind":"bundled"}]`ï¼‰

### Handler Implementationï¼ˆå®ç°ï¼‰

`handler.ts` æ–‡ä»¶å¯¼å‡ºä¸€ä¸ª `HookHandler` å‡½æ•°ï¼š

```typescript
import type { HookHandler } from '../../src/hooks/hooks.js';

const myHandler: HookHandler = async (event) => {
  // ä»…åœ¨ 'new' å‘½ä»¤æ—¶è§¦å‘
  if (event.type !== 'command' || event.action !== 'new') {
    return;
  }

  console.log(`[my-hook] New command triggered`);
  console.log(`  Session: ${event.sessionKey}`);
  console.log(`  Timestamp: ${event.timestamp.toISOString()}`);

  // æ‚¨çš„è‡ªå®šä¹‰é€»è¾‘åœ¨è¿™é‡Œ

  // å¯é€‰åœ°å‘ç”¨æˆ·å‘é€æ¶ˆæ¯
  event.messages.push('âœ¨ My hook executed!');
};

export default myHandler;
```

#### Event Contextï¼ˆäº‹ä»¶ä¸Šä¸‹æ–‡ï¼‰

æ¯ä¸ªäº‹ä»¶åŒ…æ‹¬ï¼š

```typescript
{
  type: 'command' | 'session' | 'agent' | 'gateway',
  action: string,              // ä¾‹å¦‚ 'new'ã€'reset'ã€'stop'
  sessionKey: string,          // Session æ ‡è¯†ç¬¦
  timestamp: Date,             // äº‹ä»¶å‘ç”Ÿæ—¶é—´
  messages: string[],          // åœ¨è¿™é‡Œæ¨é€æ¶ˆæ¯ä»¥å‘é€ç»™ç”¨æˆ·
  context: {
    sessionEntry?: SessionEntry,
    sessionId?: string,
    sessionFile?: string,
    commandSource?: string,    // ä¾‹å¦‚ 'whatsapp'ã€'telegram'
    senderId?: string,
    workspaceDir?: string,
    bootstrapFiles?: WorkspaceBootstrapFile[],
    cfg?: OpenClawConfig
  }
}
```

## Event Typesï¼ˆäº‹ä»¶ç±»å‹ï¼‰

### Command Eventsï¼ˆå‘½ä»¤äº‹ä»¶ï¼‰

åœ¨å‘å‡º agent å‘½ä»¤æ—¶è§¦å‘ï¼š

- **`command`**ï¼šæ‰€æœ‰å‘½ä»¤äº‹ä»¶ï¼ˆé€šç”¨ç›‘å¬å™¨ï¼‰
- **`command:new`**ï¼šå‘å‡º `/new` å‘½ä»¤æ—¶
- **`command:reset`**ï¼šå‘å‡º `/reset` å‘½ä»¤æ—¶
- **`command:stop`**ï¼šå‘å‡º `/stop` å‘½ä»¤æ—¶

### Agent Eventsï¼ˆAgent äº‹ä»¶ï¼‰

- **`agent:bootstrap`**ï¼šåœ¨æ³¨å…¥ workspace bootstrap æ–‡ä»¶ä¹‹å‰ï¼ˆhooks å¯èƒ½æ”¹å˜ `context.bootstrapFiles`ï¼‰

### Gateway Eventsï¼ˆGateway äº‹ä»¶ï¼‰

åœ¨ gateway å¯åŠ¨æ—¶è§¦å‘ï¼š

- **`gateway:startup`**ï¼šåœ¨ channels å¯åŠ¨å’Œ hooks åŠ è½½å

### Tool Result Hooks (Plugin API)

è¿™äº› hooks ä¸æ˜¯äº‹ä»¶æµç›‘å¬å™¨ï¼›å®ƒä»¬è®© plugins åœ¨ OpenClaw æŒä¹…åŒ– tool resultsï¼ˆå·¥å…·ç»“æœï¼‰ä¹‹å‰åŒæ­¥è°ƒæ•´å®ƒä»¬ã€‚

- **`tool_result_persist`**ï¼šåœ¨å°† tool results å†™å…¥ session transcriptï¼ˆä¼šè¯è®°å½•ï¼‰ä¹‹å‰å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚å¿…é¡»æ˜¯åŒæ­¥çš„ï¼›è¿”å›æ›´æ–°çš„ tool result payloadï¼ˆè½½è·ï¼‰æˆ– `undefined` ä»¥ä¿æŒåŸæ ·ã€‚å‚è§ [Agent Loop](/concepts/agent-loop)ã€‚

### Future Eventsï¼ˆæœªæ¥äº‹ä»¶ï¼‰

è®¡åˆ’çš„äº‹ä»¶ç±»å‹ï¼š

- **`session:start`**ï¼šå½“æ–° session å¼€å§‹æ—¶
- **`session:end`**ï¼šå½“ session ç»“æŸæ—¶
- **`agent:error`**ï¼šå½“ agent é‡åˆ°é”™è¯¯æ—¶
- **`message:sent`**ï¼šå½“æ¶ˆæ¯å‘é€æ—¶
- **`message:received`**ï¼šå½“æ¶ˆæ¯æ¥æ”¶æ—¶

## Creating Custom Hooksï¼ˆåˆ›å»ºè‡ªå®šä¹‰ Hooksï¼‰

### 1. é€‰æ‹©ä½ç½®

- **Workspace hooks**ï¼ˆ`<workspace>/hooks/`ï¼‰ï¼šæ¯ä¸ª agentï¼Œæœ€é«˜ä¼˜å…ˆçº§
- **Managed hooks**ï¼ˆ`~/.openclaw/hooks/`ï¼‰ï¼šè·¨ workspaces å…±äº«

### 2. åˆ›å»ºç›®å½•ç»“æ„

```bash
mkdir -p ~/.openclaw/hooks/my-hook
cd ~/.openclaw/hooks/my-hook
```

### 3. åˆ›å»º HOOK.md

```markdown
---
name: my-hook
description: "åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ…"
metadata: {"openclaw":{"emoji":"ğŸ¯","events":["command:new"]}}
---

# My Custom Hook

è¿™ä¸ª hook åœ¨æ‚¨å‘å‡º `/new` æ—¶åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ…ã€‚
```

### 4. åˆ›å»º handler.ts

```typescript
import type { HookHandler } from '../../src/hooks/hooks.js';

const handler: HookHandler = async (event) => {
  if (event.type !== 'command' || event.action !== 'new') {
    return;
  }

  console.log('[my-hook] Running!');
  // æ‚¨çš„é€»è¾‘åœ¨è¿™é‡Œ
};

export default handler;
```

### 5. å¯ç”¨å¹¶æµ‹è¯•

```bash
# éªŒè¯ hook å·²è¢«å‘ç°
openclaw hooks list

# å¯ç”¨å®ƒ
openclaw hooks enable my-hook

# é‡å¯æ‚¨çš„ gateway è¿›ç¨‹ï¼ˆmacOS ä¸Šçš„èœå•æ åº”ç”¨é‡å¯ï¼Œæˆ–é‡å¯æ‚¨çš„å¼€å‘è¿›ç¨‹ï¼‰

# è§¦å‘äº‹ä»¶
# é€šè¿‡æ‚¨çš„æ¶ˆæ¯ channel å‘é€ /new
```

## Configurationï¼ˆé…ç½®ï¼‰

### æ–°é…ç½®æ ¼å¼ï¼ˆæ¨èï¼‰

```json
{
  "hooks": {
    "internal": {
      "enabled": true,
      "entries": {
        "session-memory": { "enabled": true },
        "command-logger": { "enabled": false }
      }
    }
  }
}
```

### æ¯ä¸ª Hook çš„é…ç½®

Hooks å¯ä»¥æœ‰è‡ªå®šä¹‰é…ç½®ï¼š

```json
{
  "hooks": {
    "internal": {
      "enabled": true,
      "entries": {
        "my-hook": {
          "enabled": true,
          "env": {
            "MY_CUSTOM_VAR": "value"
          }
        }
      }
    }
  }
}
```

### é¢å¤–ç›®å½•

ä»é¢å¤–ç›®å½•åŠ è½½ hooksï¼š

```json
{
  "hooks": {
    "internal": {
      "enabled": true,
      "load": {
        "extraDirs": ["/path/to/more/hooks"]
      }
    }
  }
}
```

### Legacy Config Formatï¼ˆä»å—æ”¯æŒï¼‰

æ—§çš„é…ç½®æ ¼å¼ä»ç„¶é€‚ç”¨äºå‘åå…¼å®¹ï¼š

```json
{
  "hooks": {
    "internal": {
      "enabled": true,
      "handlers": [
        {
          "event": "command:new",
          "module": "./hooks/handlers/my-handler.ts",
          "export": "default"
        }
      ]
    }
  }
}
```

**è¿ç§»**ï¼šä¸ºæ–° hooks ä½¿ç”¨åŸºäºå‘ç°çš„æ–°ç³»ç»Ÿã€‚Legacy handlersï¼ˆä¼ ç»Ÿå¤„ç†å™¨ï¼‰åœ¨åŸºäºç›®å½•çš„ hooks ä¹‹ååŠ è½½ã€‚

## CLI Commandsï¼ˆCLI å‘½ä»¤ï¼‰

### List Hooksï¼ˆåˆ—å‡º Hooksï¼‰

```bash
# åˆ—å‡ºæ‰€æœ‰ hooks
openclaw hooks list

# ä»…æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„ hooks
openclaw hooks list --eligible

# è¯¦ç»†è¾“å‡ºï¼ˆæ˜¾ç¤ºç¼ºå°‘çš„è¦æ±‚ï¼‰
openclaw hooks list --verbose

# JSON è¾“å‡º
openclaw hooks list --json
```

### Hook Informationï¼ˆHook ä¿¡æ¯ï¼‰

```bash
# æ˜¾ç¤ºæœ‰å…³ hook çš„è¯¦ç»†ä¿¡æ¯
openclaw hooks info session-memory

# JSON è¾“å‡º
openclaw hooks info session-memory --json
```

### Check Eligibilityï¼ˆæ£€æŸ¥èµ„æ ¼ï¼‰

```bash
# æ˜¾ç¤ºèµ„æ ¼æ‘˜è¦
openclaw hooks check

# JSON è¾“å‡º
openclaw hooks check --json
```

### Enable/Disableï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

```bash
# å¯ç”¨ hook
openclaw hooks enable session-memory

# ç¦ç”¨ hook
openclaw hooks disable command-logger
```

## Bundled Hooksï¼ˆæ†ç»‘çš„ Hooksï¼‰

### session-memory

åœ¨æ‚¨å‘å‡º `/new` æ—¶å°† session context ä¿å­˜åˆ° memoryã€‚

**Events**ï¼š`command:new`

**Requirements**ï¼šå¿…é¡»é…ç½® `workspace.dir`

**Output**ï¼š`<workspace>/memory/YYYY-MM-DD-slug.md`ï¼ˆé»˜è®¤ä¸º `~/.openclaw/workspace`ï¼‰

**å®ƒçš„ä½œç”¨**ï¼š
1. ä½¿ç”¨é‡ç½®å‰çš„ session entry æ¥å®šä½æ­£ç¡®çš„ transcriptï¼ˆè®°å½•ï¼‰
2. æå–å¯¹è¯çš„æœ€å 15 è¡Œ
3. ä½¿ç”¨ LLM ç”Ÿæˆæè¿°æ€§çš„æ–‡ä»¶å slug
4. å°† session metadata ä¿å­˜åˆ°æ—¥æœŸè®°å½•æ–‡ä»¶

**è¾“å‡ºç¤ºä¾‹**ï¼š

```markdown
# Session: 2026-01-16 14:30:00 UTC

- **Session Key**: agent:main:main
- **Session ID**: abc123def456
- **Source**: telegram
```

**æ–‡ä»¶åç¤ºä¾‹**ï¼š
- `2026-01-16-vendor-pitch.md`
- `2026-01-16-api-design.md`
- `2026-01-16-1430.md`ï¼ˆå¦‚æœ slug ç”Ÿæˆå¤±è´¥åˆ™å›é€€åˆ° timestampï¼ˆæ—¶é—´æˆ³ï¼‰ï¼‰

**å¯ç”¨**ï¼š

```bash
openclaw hooks enable session-memory
```

### command-logger

å°†æ‰€æœ‰å‘½ä»¤äº‹ä»¶è®°å½•åˆ°é›†ä¸­å¼å®¡è®¡æ–‡ä»¶ã€‚

**Events**ï¼š`command`

**Requirements**ï¼šæ— 

**Output**ï¼š`~/.openclaw/logs/commands.log`

**å®ƒçš„ä½œç”¨**ï¼š
1. æ•è·äº‹ä»¶è¯¦ç»†ä¿¡æ¯ï¼ˆå‘½ä»¤æ“ä½œã€æ—¶é—´æˆ³ã€session keyã€sender IDã€sourceï¼‰
2. ä»¥ JSONL æ ¼å¼é™„åŠ åˆ°æ—¥å¿—æ–‡ä»¶
3. åœ¨åå°é™é»˜è¿è¡Œ

**æ—¥å¿—æ¡ç›®ç¤ºä¾‹**ï¼š

```jsonl
{"timestamp":"2026-01-16T14:30:00.000Z","action":"new","sessionKey":"agent:main:main","senderId":"+1234567890","source":"telegram"}
{"timestamp":"2026-01-16T15:45:22.000Z","action":"stop","sessionKey":"agent:main:main","senderId":"user@example.com","source":"whatsapp"}
```

**æŸ¥çœ‹æ—¥å¿—**ï¼š

```bash
# æŸ¥çœ‹æœ€è¿‘çš„å‘½ä»¤
tail -n 20 ~/.openclaw/logs/commands.log

# ä½¿ç”¨ jq æ ¼å¼åŒ–è¾“å‡º
cat ~/.openclaw/logs/commands.log | jq .

# æŒ‰æ“ä½œè¿‡æ»¤
grep '"action":"new"' ~/.openclaw/logs/commands.log | jq .
```

**å¯ç”¨**ï¼š

```bash
openclaw hooks enable command-logger
```

### soul-evil

åœ¨æ¸…é™¤çª—å£æœŸé—´æˆ–éšæœºæƒ…å†µä¸‹å°†æ³¨å…¥çš„ `SOUL.md` å†…å®¹ä¸ `SOUL_EVIL.md` äº¤æ¢ã€‚

**Events**ï¼š`agent:bootstrap`

**Docs**ï¼š[SOUL Evil Hook](/hooks/soul-evil)

**Output**ï¼šä¸å†™å…¥æ–‡ä»¶ï¼›äº¤æ¢ä»…åœ¨å†…å­˜ä¸­å‘ç”Ÿã€‚

**å¯ç”¨**ï¼š

```bash
openclaw hooks enable soul-evil
```

**Config**ï¼š

```json
{
  "hooks": {
    "internal": {
      "enabled": true,
      "entries": {
        "soul-evil": {
          "enabled": true,
          "file": "SOUL_EVIL.md",
          "chance": 0.1,
          "purge": { "at": "21:00", "duration": "15m" }
        }
      }
    }
  }
}
```

### boot-md

åœ¨ gateway å¯åŠ¨æ—¶è¿è¡Œ `BOOT.md`ï¼ˆåœ¨ channels å¯åŠ¨åï¼‰ã€‚
å¿…é¡»å¯ç”¨å†…éƒ¨ hooks æ‰èƒ½è¿è¡Œã€‚

**Events**ï¼š`gateway:startup`

**Requirements**ï¼šå¿…é¡»é…ç½® `workspace.dir`

**å®ƒçš„ä½œç”¨**ï¼š
1. ä»æ‚¨çš„ workspace è¯»å– `BOOT.md`
2. é€šè¿‡ agent runner è¿è¡ŒæŒ‡ä»¤
3. é€šè¿‡ message tool å‘é€ä»»ä½•è¯·æ±‚çš„å‡ºç«™æ¶ˆæ¯

**å¯ç”¨**ï¼š

```bash
openclaw hooks enable boot-md
```

## Best Practicesï¼ˆæœ€ä½³å®è·µï¼‰

### ä¿æŒ Handlers å¿«é€Ÿ

Hooks åœ¨å‘½ä»¤å¤„ç†æœŸé—´è¿è¡Œã€‚ä¿æŒå®ƒä»¬è½»é‡çº§ï¼š

```typescript
// âœ“ å¥½ - å¼‚æ­¥å·¥ä½œï¼Œç«‹å³è¿”å›
const handler: HookHandler = async (event) => {
  void processInBackground(event); // Fire and forgetï¼ˆå‘å°„åä¸ç®¡ï¼‰
};

// âœ— å - é˜»å¡å‘½ä»¤å¤„ç†
const handler: HookHandler = async (event) => {
  await slowDatabaseQuery(event);
  await evenSlowerAPICall(event);
};
```

### ä¼˜é›…åœ°å¤„ç†é”™è¯¯

å§‹ç»ˆåŒ…è£…æœ‰é£é™©çš„æ“ä½œï¼š

```typescript
const handler: HookHandler = async (event) => {
  try {
    await riskyOperation(event);
  } catch (err) {
    console.error('[my-handler] Failed:', err instanceof Error ? err.message : String(err));
    // ä¸è¦æŠ›å‡º - è®©å…¶ä»– handlers è¿è¡Œ
  }
};
```

### å°½æ—©è¿‡æ»¤äº‹ä»¶

å¦‚æœäº‹ä»¶ä¸ç›¸å…³ï¼Œå°½æ—©è¿”å›ï¼š

```typescript
const handler: HookHandler = async (event) => {
  // ä»…å¤„ç† 'new' å‘½ä»¤
  if (event.type !== 'command' || event.action !== 'new') {
    return;
  }

  // æ‚¨çš„é€»è¾‘åœ¨è¿™é‡Œ
};
```

### ä½¿ç”¨ç‰¹å®šäº‹ä»¶é”®

åœ¨ metadata ä¸­å°½å¯èƒ½æŒ‡å®šç¡®åˆ‡çš„äº‹ä»¶ï¼š

```yaml
metadata: {"openclaw":{"events":["command:new"]}}  # å…·ä½“
```

è€Œä¸æ˜¯ï¼š

```yaml
metadata: {"openclaw":{"events":["command"]}}      # é€šç”¨ - æ›´å¤šå¼€é”€
```

## Debuggingï¼ˆè°ƒè¯•ï¼‰

### å¯ç”¨ Hook Loggingï¼ˆæ—¥å¿—è®°å½•ï¼‰

Gateway åœ¨å¯åŠ¨æ—¶è®°å½• hook åŠ è½½ï¼š

```
Registered hook: session-memory -> command:new
Registered hook: command-logger -> command
Registered hook: boot-md -> gateway:startup
```

### æ£€æŸ¥ Discovery

åˆ—å‡ºæ‰€æœ‰å‘ç°çš„ hooksï¼š

```bash
openclaw hooks list --verbose
```

### æ£€æŸ¥ Registrationï¼ˆæ³¨å†Œï¼‰

åœ¨æ‚¨çš„ handler ä¸­ï¼Œè®°å½•å®ƒä½•æ—¶è¢«è°ƒç”¨ï¼š

```typescript
const handler: HookHandler = async (event) => {
  console.log('[my-handler] Triggered:', event.type, event.action);
  // æ‚¨çš„é€»è¾‘
};
```

### éªŒè¯èµ„æ ¼

æ£€æŸ¥ä¸ºä»€ä¹ˆ hook ä¸ç¬¦åˆæ¡ä»¶ï¼š

```bash
openclaw hooks info my-hook
```

åœ¨è¾“å‡ºä¸­æŸ¥æ‰¾ç¼ºå°‘çš„è¦æ±‚ã€‚

## Testingï¼ˆæµ‹è¯•ï¼‰

### Gateway Logs

ç›‘è§† gateway æ—¥å¿—ä»¥æŸ¥çœ‹ hook æ‰§è¡Œï¼š

```bash
# macOS
./scripts/clawlog.sh -f

# å…¶ä»–å¹³å°
tail -f ~/.openclaw/gateway.log
```

### ç›´æ¥æµ‹è¯• Hooks

å•ç‹¬æµ‹è¯•æ‚¨çš„ handlersï¼š

```typescript
import { test } from 'vitest';
import { createHookEvent } from './src/hooks/hooks.js';
import myHandler from './hooks/my-hook/handler.js';

test('my handler works', async () => {
  const event = createHookEvent('command', 'new', 'test-session', {
    foo: 'bar'
  });

  await myHandler(event);

  // æ–­è¨€å‰¯ä½œç”¨
});
```

## Architectureï¼ˆæ¶æ„ï¼‰

### Core Componentsï¼ˆæ ¸å¿ƒç»„ä»¶ï¼‰

- **`src/hooks/types.ts`**ï¼šç±»å‹å®šä¹‰
- **`src/hooks/workspace.ts`**ï¼šç›®å½•æ‰«æå’ŒåŠ è½½
- **`src/hooks/frontmatter.ts`**ï¼šHOOK.md metadata è§£æ
- **`src/hooks/config.ts`**ï¼šèµ„æ ¼æ£€æŸ¥
- **`src/hooks/hooks-status.ts`**ï¼šçŠ¶æ€æŠ¥å‘Š
- **`src/hooks/loader.ts`**ï¼šåŠ¨æ€æ¨¡å—åŠ è½½å™¨
- **`src/cli/hooks-cli.ts`**ï¼šCLI å‘½ä»¤
- **`src/gateway/server-startup.ts`**ï¼šåœ¨ gateway å¯åŠ¨æ—¶åŠ è½½ hooks
- **`src/auto-reply/reply/commands-core.ts`**ï¼šè§¦å‘å‘½ä»¤äº‹ä»¶

### Discovery Flowï¼ˆå‘ç°æµç¨‹ï¼‰

```
Gateway å¯åŠ¨
    â†“
æ‰«æç›®å½•ï¼ˆworkspace â†’ managed â†’ bundledï¼‰
    â†“
è§£æ HOOK.md æ–‡ä»¶
    â†“
æ£€æŸ¥èµ„æ ¼ï¼ˆbinsã€envã€configã€osï¼‰
    â†“
ä»ç¬¦åˆæ¡ä»¶çš„ hooks åŠ è½½ handlers
    â†“
ä¸ºäº‹ä»¶æ³¨å†Œ handlers
```

### Event Flowï¼ˆäº‹ä»¶æµç¨‹ï¼‰

```
ç”¨æˆ·å‘é€ /new
    â†“
å‘½ä»¤éªŒè¯
    â†“
åˆ›å»º hook äº‹ä»¶
    â†“
è§¦å‘ hookï¼ˆæ‰€æœ‰å·²æ³¨å†Œçš„ handlersï¼‰
    â†“
å‘½ä»¤å¤„ç†ç»§ç»­
    â†“
Session é‡ç½®
```

## Troubleshootingï¼ˆæ•…éšœæ’æŸ¥ï¼‰

### Hook Not Discoveredï¼ˆHook æœªè¢«å‘ç°ï¼‰

1. æ£€æŸ¥ç›®å½•ç»“æ„ï¼š
   ```bash
   ls -la ~/.openclaw/hooks/my-hook/
   # åº”è¯¥æ˜¾ç¤ºï¼šHOOK.mdã€handler.ts
   ```

2. éªŒè¯ HOOK.md æ ¼å¼ï¼š
   ```bash
   cat ~/.openclaw/hooks/my-hook/HOOK.md
   # åº”è¯¥æœ‰åŒ…å« name å’Œ metadata çš„ YAML frontmatter
   ```

3. åˆ—å‡ºæ‰€æœ‰å‘ç°çš„ hooksï¼š
   ```bash
   openclaw hooks list
   ```

### Hook Not Eligibleï¼ˆHook ä¸ç¬¦åˆæ¡ä»¶ï¼‰

æ£€æŸ¥è¦æ±‚ï¼š

```bash
openclaw hooks info my-hook
```

æŸ¥æ‰¾ç¼ºå°‘çš„ï¼š
- Binariesï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼ˆæ£€æŸ¥ PATHï¼‰
- Environment variablesï¼ˆç¯å¢ƒå˜é‡ï¼‰
- Config valuesï¼ˆé…ç½®å€¼ï¼‰
- OS compatibilityï¼ˆæ“ä½œç³»ç»Ÿå…¼å®¹æ€§ï¼‰

### Hook Not Executingï¼ˆHook æœªæ‰§è¡Œï¼‰

1. éªŒè¯ hook å·²å¯ç”¨ï¼š
   ```bash
   openclaw hooks list
   # åº”è¯¥åœ¨å·²å¯ç”¨çš„ hooks æ—è¾¹æ˜¾ç¤º âœ“
   ```

2. é‡å¯æ‚¨çš„ gateway è¿›ç¨‹ä»¥ä¾¿ hooks é‡æ–°åŠ è½½ã€‚

3. æ£€æŸ¥ gateway æ—¥å¿—ä»¥æŸ¥æ‰¾é”™è¯¯ï¼š
   ```bash
   ./scripts/clawlog.sh | grep hook
   ```

### Handler Errorsï¼ˆHandler é”™è¯¯ï¼‰

æ£€æŸ¥ TypeScript/import é”™è¯¯ï¼š

```bash
# ç›´æ¥æµ‹è¯• import
node -e "import('./path/to/handler.ts').then(console.log)"
```

## Migration Guideï¼ˆè¿ç§»æŒ‡å—ï¼‰

### ä» Legacy Config åˆ° Discovery

**ä¹‹å‰**ï¼š

```json
{
  "hooks": {
    "internal": {
      "enabled": true,
      "handlers": [
        {
          "event": "command:new",
          "module": "./hooks/handlers/my-handler.ts"
        }
      ]
    }
  }
}
```

**ä¹‹å**ï¼š

1. åˆ›å»º hook ç›®å½•ï¼š
   ```bash
   mkdir -p ~/.openclaw/hooks/my-hook
   mv ./hooks/handlers/my-handler.ts ~/.openclaw/hooks/my-hook/handler.ts
   ```

2. åˆ›å»º HOOK.mdï¼š
   ```markdown
   ---
   name: my-hook
   description: "æˆ‘çš„è‡ªå®šä¹‰ hook"
   metadata: {"openclaw":{"emoji":"ğŸ¯","events":["command:new"]}}
   ---

   # My Hook

   åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ…ã€‚
   ```

3. æ›´æ–°é…ç½®ï¼š
   ```json
   {
     "hooks": {
       "internal": {
         "enabled": true,
         "entries": {
           "my-hook": { "enabled": true }
         }
       }
     }
   }
   ```

4. éªŒè¯å¹¶é‡å¯æ‚¨çš„ gateway è¿›ç¨‹ï¼š
   ```bash
   openclaw hooks list
   # åº”è¯¥æ˜¾ç¤ºï¼šğŸ¯ my-hook âœ“
   ```

**è¿ç§»çš„å¥½å¤„**ï¼š
- è‡ªåŠ¨å‘ç°
- CLI ç®¡ç†
- èµ„æ ¼æ£€æŸ¥
- æ›´å¥½çš„æ–‡æ¡£
- ä¸€è‡´çš„ç»“æ„

## See Alsoï¼ˆå¦è§ï¼‰

- [CLI Reference: hooks](/cli/hooks)
- [Bundled Hooks README](https://github.com/openclaw/openclaw/tree/main/src/hooks/bundled)
- [Webhook Hooks](/automation/webhook)
- [Configuration](/gateway/configuration#hooks)
