---
summary: "Контрольный список выпуска OpenClaw для macOS (лента Sparkle, упаковка, подпись)"
read_when:
  - Создание или проверка выпуска OpenClaw для macOS
  - Обновление ленты Sparkle или ресурсов ленты
---

# Выпуск OpenClaw для macOS (Sparkle)

Это приложение теперь поставляется с автоматическими обновлениями Sparkle. Релизные сборки должны быть подписаны Developer ID, упакованы в zip и опубликованы с подписанной записью appcast.

## Предварительные требования
- Установлен сертификат Developer ID Application (пример: `Developer ID Application: <Developer Name> (<TEAMID>)`).
- Путь к приватному ключу Sparkle установлен в переменной окружения `SPARKLE_PRIVATE_KEY_FILE` (путь к вашему приватному ключу Sparkle ed25519; публичный ключ встроен в Info.plist). Если он отсутствует, проверьте `~/.profile`.
- Учетные данные нотариуса (профиль keychain или API-ключ) для `xcrun notarytool`, если вы хотите безопасное для Gatekeeper распространение DMG/zip.
  - Мы используем профиль Keychain с именем `openclaw-notary`, созданный из переменных окружения API-ключа App Store Connect в вашем профиле оболочки:
    - `APP_STORE_CONNECT_API_KEY_P8`, `APP_STORE_CONNECT_KEY_ID`, `APP_STORE_CONNECT_ISSUER_ID`
    - `echo "$APP_STORE_CONNECT_API_KEY_P8" | sed 's/\\n/\n/g' > /tmp/openclaw-notary.p8`
    - `xcrun notarytool store-credentials "openclaw-notary" --key /tmp/openclaw-notary.p8 --key-id "$APP_STORE_CONNECT_KEY_ID" --issuer "$APP_STORE_CONNECT_ISSUER_ID"`
- Установлены зависимости `pnpm` (`pnpm install --config.node-linker=hoisted`).
- Инструменты Sparkle извлекаются автоматически через SwiftPM в `apps/macos/.build/artifacts/sparkle/Sparkle/bin/` (`sign_update`, `generate_appcast` и т. д.).

## Сборка и упаковка
Примечания:
- `APP_BUILD` соответствует `CFBundleVersion`/`sparkle:version`; держите его числовым + монотонным (без `-beta`), иначе Sparkle сравнивает его как равный.
- По умолчанию текущая архитектура (`$(uname -m)`). Для релизных/универсальных сборок установите `BUILD_ARCHS="arm64 x86_64"` (или `BUILD_ARCHS=all`).
- Используйте `scripts/package-mac-dist.sh` для релизных артефактов (zip + DMG + нотаризация). Используйте `scripts/package-mac-app.sh` для локальной/dev упаковки.

```bash
# Из корня репозитория; установите релизные ID, чтобы лента Sparkle была включена.
# APP_BUILD должен быть числовым + монотонным для сравнения Sparkle.
BUNDLE_ID=bot.molt.mac \
APP_VERSION=2026.1.27-beta.1 \
APP_BUILD="$(git rev-list --count HEAD)" \
BUILD_CONFIG=release \
SIGN_IDENTITY="Developer ID Application: <Developer Name> (<TEAMID>)" \
scripts/package-mac-app.sh

# Zip для распространения (включает resource forks для поддержки дельта Sparkle)
ditto -c -k --sequesterRsrc --keepParent dist/OpenClaw.app dist/OpenClaw-2026.1.27-beta.1.zip

# Опционально: также создайте стилизованный DMG для людей (перетащите в /Applications)
scripts/create-dmg.sh dist/OpenClaw.app dist/OpenClaw-2026.1.27-beta.1.dmg

# Рекомендуется: сборка + нотаризация/staple zip + DMG
# Сначала создайте профиль keychain один раз:
#   xcrun notarytool store-credentials "openclaw-notary" \
#     --apple-id "<apple-id>" --team-id "<team-id>" --password "<app-specific-password>"
NOTARIZE=1 NOTARYTOOL_PROFILE=openclaw-notary \
BUNDLE_ID=bot.molt.mac \
APP_VERSION=2026.1.27-beta.1 \
APP_BUILD="$(git rev-list --count HEAD)" \
BUILD_CONFIG=release \
SIGN_IDENTITY="Developer ID Application: <Developer Name> (<TEAMID>)" \
scripts/package-mac-dist.sh

# Опционально: отправьте dSYM вместе с релизом
ditto -c -k --keepParent apps/macos/.build/release/OpenClaw.app.dSYM dist/OpenClaw-2026.1.27-beta.1.dSYM.zip
```

## Запись Appcast
Используйте генератор заметок о выпуске, чтобы Sparkle отображал отформатированные HTML-заметки:
```bash
SPARKLE_PRIVATE_KEY_FILE=/path/to/ed25519-private-key scripts/make_appcast.sh dist/OpenClaw-2026.1.27-beta.1.zip https://raw.githubusercontent.com/openclaw/openclaw/main/appcast.xml
```
Генерирует HTML-заметки о выпуске из `CHANGELOG.md` (через [`scripts/changelog-to-html.sh`](https://github.com/openclaw/openclaw/blob/main/scripts/changelog-to-html.sh)) и встраивает их в запись appcast.
Зафиксируйте обновленный `appcast.xml` вместе с релизными ресурсами (zip + dSYM) при публикации.

## Публикация и проверка
- Загрузите `OpenClaw-2026.1.27-beta.1.zip` (и `OpenClaw-2026.1.27-beta.1.dSYM.zip`) в релиз GitHub для тега `v2026.1.27-beta.1`.
- Убедитесь, что URL-адрес raw appcast соответствует встроенной ленте: `https://raw.githubusercontent.com/openclaw/openclaw/main/appcast.xml`.
- Проверки работоспособности:
  - `curl -I https://raw.githubusercontent.com/openclaw/openclaw/main/appcast.xml` возвращает 200.
  - `curl -I <enclosure url>` возвращает 200 после загрузки ресурсов.
  - В предыдущей публичной сборке запустите "Проверить обновления..." на вкладке "О программе" и убедитесь, что Sparkle устанавливает новую сборку без проблем.

Определение завершения: подписанное приложение + appcast опубликованы, процесс обновления работает со старой установленной версии, и релизные ресурсы прикреплены к релизу GitHub.
