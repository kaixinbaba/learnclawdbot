---
summary: "Запуск моста ACP для интеграций с IDE"
read_when:
  - Настройка интеграций с IDE на основе ACP
  - Отладка маршрутизации сессий ACP к Gateway
---

# acp

Запуск моста ACP (Agent Client Protocol), который взаимодействует со шлюзом OpenClaw.

Эта команда использует ACP через stdio для IDE и перенаправляет подсказки в Gateway
через WebSocket. Она сохраняет сопоставление сессий ACP с ключами сессий Gateway.

## Использование

```bash
openclaw acp

# Удаленный Gateway
openclaw acp --url wss://gateway-host:18789 --token <token>

# Прикрепить к существующему ключу сессии
openclaw acp --session agent:main:main

# Прикрепить по метке (должна уже существовать)
openclaw acp --session-label "support inbox"

# Сбросить ключ сессии перед первым запросом
openclaw acp --session agent:main:main --reset-session
```

## Клиент ACP (отладка)

Используйте встроенный клиент ACP для проверки моста без IDE.
Он порождает мост ACP и позволяет вводить подсказки интерактивно.

```bash
openclaw acp client

# Направить порожденный мост на удаленный Gateway
openclaw acp client --server-args --url wss://gateway-host:18789 --token <token>

# Переопределить команду сервера (по умолчанию: openclaw)
openclaw acp client --server "node" --server-args openclaw.mjs acp --url ws://127.0.0.1:19001
```

## Как это использовать

Используйте ACP, когда IDE (или другой клиент) говорит на Agent Client Protocol, и вы хотите,
чтобы он управлял сессией OpenClaw Gateway.

1. Убедитесь, что Gateway запущен (локально или удаленно).
2. Настройте цель Gateway (конфигурация или флаги).
3. Настройте свою IDE для запуска `openclaw acp` через stdio.

Пример конфигурации (сохраняется):

```bash
openclaw config set gateway.remote.url wss://gateway-host:18789
openclaw config set gateway.remote.token <token>
```

Пример прямого запуска (без записи конфигурации):

```bash
openclaw acp --url wss://gateway-host:18789 --token <token>
```

## Выбор агентов

ACP не выбирает агентов напрямую. Он маршрутизирует по ключу сессии Gateway.

Используйте ключи сессий с областью агента для таргетинга конкретного агента:

```bash
openclaw acp --session agent:main:main
openclaw acp --session agent:design:main
openclaw acp --session agent:qa:bug-123
```

Каждая сессия ACP сопоставляется с одним ключом сессии Gateway. Один агент может иметь много
сессий; ACP по умолчанию использует изолированную сессию `acp:<uuid>`, если вы не переопределите
ключ или метку.

## Настройка редактора Zed

Добавьте пользовательского агента ACP в `~/.config/zed/settings.json` (или используйте UI настроек Zed):

```json
{
  "agent_servers": {
    "OpenClaw ACP": {
      "type": "custom",
      "command": "openclaw",
      "args": ["acp"],
      "env": {}
    }
  }
}
```

Для таргетинга конкретного Gateway или агента:

```json
{
  "agent_servers": {
    "OpenClaw ACP": {
      "type": "custom",
      "command": "openclaw",
      "args": [
        "acp",
        "--url", "wss://gateway-host:18789",
        "--token", "<token>",
        "--session", "agent:design:main"
      ],
      "env": {}
    }
  }
}
```

В Zed откройте панель Agent и выберите "OpenClaw ACP" для начала треда.

## Сопоставление сессий

По умолчанию сессии ACP получают изолированный ключ сессии Gateway с префиксом `acp:`.
Чтобы переиспользовать известную сессию, передайте ключ сессии или метку:

- `--session <key>`: использовать конкретный ключ сессии Gateway.
- `--session-label <label>`: разрешить существующую сессию по метке.
- `--reset-session`: создать свежий ID сессии для этого ключа (тот же ключ, новая расшифровка).

Если ваш клиент ACP поддерживает метаданные, вы можете переопределить для каждой сессии:

```json
{
  "_meta": {
    "sessionKey": "agent:main:main",
    "sessionLabel": "support inbox",
    "resetSession": true
  }
}
```

Узнайте больше о ключах сессий на [/concepts/session](/concepts/session).

## Опции

- `--url <url>`: URL WebSocket Gateway (по умолчанию gateway.remote.url при настройке).
- `--token <token>`: токен аутентификации Gateway.
- `--password <password>`: пароль аутентификации Gateway.
- `--session <key>`: ключ сессии по умолчанию.
- `--session-label <label>`: метка сессии по умолчанию для разрешения.
- `--require-existing`: сбой, если ключ/метка сессии не существует.
- `--reset-session`: сбросить ключ сессии перед первым использованием.
- `--no-prefix-cwd`: не добавлять рабочий каталог к подсказкам.
- `--verbose, -v`: подробное логирование в stderr.

### Опции `acp client`

- `--cwd <dir>`: рабочий каталог для сессии ACP.
- `--server <command>`: команда сервера ACP (по умолчанию: `openclaw`).
- `--server-args <args...>`: дополнительные аргументы, передаваемые серверу ACP.
- `--server-verbose`: включить подробное логирование на сервере ACP.
- `--verbose, -v`: подробное логирование клиента.
