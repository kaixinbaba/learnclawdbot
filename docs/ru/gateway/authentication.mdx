---
summary: "Аутентификация моделей: OAuth, API-ключи и setup-token"
read_when:
  - Отладка аутентификации модели или истечения срока OAuth
  - Документирование аутентификации или хранения учетных данных
---
# Аутентификация

OpenClaw поддерживает OAuth и API-ключи для поставщиков моделей. Для учетных записей Anthropic мы рекомендуем использовать **API-ключ**. Для доступа к подписке Claude используйте долгоживущий токен, созданный с помощью `claude setup-token`.

Смотрите [/concepts/oauth](/concepts/oauth) для полного описания потока OAuth и структуры хранения.

## Рекомендуемая настройка Anthropic (API-ключ)

Если вы используете Anthropic напрямую, используйте API-ключ.

1) Создайте API-ключ в консоли Anthropic.
2) Разместите его на **хосте шлюза** (машине, на которой работает `openclaw gateway`).

```bash
export ANTHROPIC_API_KEY="..."
openclaw models status
```

3) Если шлюз работает под systemd/launchd, лучше поместить ключ в `~/.openclaw/.env`, чтобы демон мог его прочитать:

```bash
cat >> ~/.openclaw/.env <<'EOF'
ANTHROPIC_API_KEY=...
EOF
```

Затем перезапустите демон (или перезапустите процесс шлюза) и проверьте снова:

```bash
openclaw models status
openclaw doctor
```

Если вы не хотите управлять переменными окружения самостоятельно, мастер настройки может сохранить API-ключи для использования демоном: `openclaw onboard`.

Смотрите [Help](/help) для деталей о наследовании окружения (`env.shellEnv`, `~/.openclaw/.env`, systemd/launchd).

## Anthropic: setup-token (аутентификация подписки)

Для Anthropic рекомендуемый путь — это **API-ключ**. Если вы используете подписку Claude, также поддерживается поток setup-token. Запустите его на **хосте шлюза**:

```bash
claude setup-token
```

Затем вставьте его в OpenClaw:

```bash
openclaw models auth setup-token --provider anthropic
```

Если токен был создан на другой машине, вставьте его вручную:

```bash
openclaw models auth paste-token --provider anthropic
```

Если вы видите ошибку Anthropic вроде:

```
This credential is only authorized for use with Claude Code and cannot be used for other API requests.
```

…используйте вместо этого API-ключ Anthropic.

Ручной ввод токена (любой поставщик; записывает `auth-profiles.json` + обновляет конфигурацию):

```bash
openclaw models auth paste-token --provider anthropic
openclaw models auth paste-token --provider openrouter
```

Проверка, удобная для автоматизации (завершается с `1` при истечении/отсутствии, `2` при истечении срока):

```bash
openclaw models status --check
```

Опциональные скрипты операций (systemd/Termux) задокументированы здесь: [/automation/auth-monitoring](/automation/auth-monitoring)

> `claude setup-token` требует интерактивный TTY.

## Проверка статуса аутентификации модели

```bash
openclaw models status
openclaw doctor
```

## Управление используемыми учетными данными

### По сессии (команда чата)

Используйте `/model <alias-or-id>@<profileId>` для привязки определенных учетных данных поставщика к текущей сессии (примеры идентификаторов профилей: `anthropic:default`, `anthropic:work`).

Используйте `/model` (или `/model list`) для компактного выбора; используйте `/model status` для полного просмотра (кандидаты + следующий профиль аутентификации, плюс детали конечной точки поставщика при настройке).

### По агенту (переопределение CLI)

Установите явное переопределение порядка профилей аутентификации для агента (сохраняется в `auth-profiles.json` этого агента):

```bash
openclaw models auth order get --provider anthropic
openclaw models auth order set --provider anthropic anthropic:default
openclaw models auth order clear --provider anthropic
```

Используйте `--agent <id>` для нацеливания на конкретного агента; пропустите для использования настроенного агента по умолчанию.

## Устранение неполадок

### "No credentials found"

Если профиль токена Anthropic отсутствует, запустите `claude setup-token` на **хосте шлюза**, затем проверьте снова:

```bash
openclaw models status
```

### Истечение срока действия токена

Запустите `openclaw models status` для подтверждения истекающего профиля. Если профиль отсутствует, перезапустите `claude setup-token` и вставьте токен снова.

## Требования

- Подписка Claude Max или Pro (для `claude setup-token`)
- Установленный Claude Code CLI (команда `claude` доступна)
