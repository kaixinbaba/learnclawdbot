---
summary: "Использование Anthropic Claude через API ключи или setup-token в OpenClaw"
read_when:
  - Вы хотите использовать модели Anthropic в OpenClaw
  - Вам нужен setup-token вместо API ключей
---
# Anthropic (Claude)

Anthropic создает семейство моделей **Claude** и предоставляет доступ через API.
В OpenClaw вы можете аутентифицироваться с помощью API ключа или **setup-token**.

## Вариант A: API ключ Anthropic

**Лучше для:** стандартного доступа к API и оплаты по использованию.
Создайте свой API ключ в консоли Anthropic.

### Настройка через CLI

```bash
openclaw onboard
# выберите: Anthropic API key

# или неинтерактивно
openclaw onboard --anthropic-api-key "$ANTHROPIC_API_KEY"
```

### Фрагмент конфигурации

```json5
{
  env: { ANTHROPIC_API_KEY: "sk-ant-..." },
  agents: { defaults: { model: { primary: "anthropic/claude-opus-4-5" } } }
}
```

## Кэширование промптов (Anthropic API)

OpenClaw **не** переопределяет стандартный TTL кэша Anthropic, если вы не установите его.
Это **только для API**; аутентификация по подписке не учитывает настройки TTL.

Чтобы установить TTL для каждой модели, используйте `cacheControlTtl` в `params` модели:

```json5
{
  agents: {
    defaults: {
      models: {
        "anthropic/claude-opus-4-5": {
          params: { cacheControlTtl: "5m" } // или "1h"
        }
      }
    }
  }
}
```

OpenClaw включает бета-флаг `extended-cache-ttl-2025-04-11` для запросов к Anthropic API; сохраните его, если переопределяете заголовки провайдера (см. [/gateway/configuration](/gateway/configuration)).

## Вариант B: Claude setup-token

**Лучше для:** использования вашей подписки Claude.

### Где получить setup-token

Setup-токены создаются **Claude Code CLI**, а не консолью Anthropic. Вы можете запустить это на **любой машине**:

```bash
claude setup-token
```

Вставьте токен в OpenClaw (мастер: **Anthropic token (paste setup-token)**), или запустите на хосте gateway:

```bash
openclaw models auth setup-token --provider anthropic
```

Если вы сгенерировали токен на другой машине, вставьте его:

```bash
openclaw models auth paste-token --provider anthropic
```

### Настройка через CLI

```bash
# Вставьте setup-token во время адаптации
openclaw onboard --auth-choice setup-token
```

### Фрагмент конфигурации

```json5
{
  agents: { defaults: { model: { primary: "anthropic/claude-opus-4-5" } } }
}
```

## Примечания

- Сгенерируйте setup-token с помощью `claude setup-token` и вставьте его, или запустите `openclaw models auth setup-token` на хосте gateway.
- Если вы видите "OAuth token refresh failed …" с подпиской Claude, переаутентифицируйтесь с помощью setup-token. См. [/gateway/troubleshooting#oauth-token-refresh-failed-anthropic-claude-subscription](/gateway/troubleshooting#oauth-token-refresh-failed-anthropic-claude-subscription).
- Детали аутентификации + правила повторного использования в [/concepts/oauth](/concepts/oauth).

## Устранение неполадок

**401 ошибки / токен внезапно недействителен**
- Аутентификация подписки Claude может истечь или быть отозвана. Запустите заново `claude setup-token`
  и вставьте его на **хосте gateway**.
- Если логин Claude CLI находится на другой машине, используйте
  `openclaw models auth paste-token --provider anthropic` на хосте gateway.

**Не найден API ключ для провайдера "anthropic"**
- Аутентификация **для каждого агента**. Новые агенты не наследуют ключи главного агента.
- Запустите заново адаптацию для этого агента, или вставьте setup-token / API ключ на
  хосте gateway, затем проверьте с помощью `openclaw models status`.

**Не найдены учетные данные для профиля `anthropic:default`**
- Запустите `openclaw models status`, чтобы увидеть, какой профиль аутентификации активен.
- Запустите заново адаптацию, или вставьте setup-token / API ключ для этого профиля.

**Нет доступного профиля аутентификации (все в кулдауне/недоступны)**
- Проверьте `openclaw models status --json` для `auth.unusableProfiles`.
- Добавьте еще один профиль Anthropic или подождите окончания кулдауна.

Подробнее: [/gateway/troubleshooting](/gateway/troubleshooting) и [/help/faq](/help/faq).
