---
summary: "OpenClawがプロンプトコンテキストを構築し、トークン使用量+コストを報告する方法"
read_when:
  - トークン使用量、コスト、またはコンテキストウィンドウを説明する場合
  - コンテキストの成長またはコンパクション動作をデバッグする場合
---
# トークン使用量とコスト

OpenClawは文字数ではなく**トークン**を追跡します。トークンはモデル固有ですが、ほとんどのOpenAIスタイルモデルは英語テキストで1トークンあたり平均約4文字です。

## システムプロンプトの構築方法

OpenClawは実行ごとに独自のシステムプロンプトを組み立てます。以下が含まれます：

- ツールリスト+簡単な説明
- スキルリスト（メタデータのみ。指示は`read`でオンデマンドで読み込まれる）
- 自己更新指示
- ワークスペース+ブートストラップファイル（`AGENTS.md`、`SOUL.md`、`TOOLS.md`、`IDENTITY.md`、`USER.md`、`HEARTBEAT.md`、新規時は`BOOTSTRAP.md`）。大きなファイルは`agents.defaults.bootstrapMaxChars`（デフォルト：20000）で切り詰められます。
- 時刻（UTC +ユーザータイムゾーン）
- 返信タグ+ハートビート動作
- ランタイムメタデータ（host/OS/model/thinking）

完全な内訳は[System Prompt](/concepts/system-prompt)を参照してください。

## コンテキストウィンドウでカウントされるもの

モデルが受け取るすべてがコンテキスト制限にカウントされます：

- システムプロンプト（上記のすべてのセクション）
- 会話履歴（ユーザー+アシスタントメッセージ）
- ツール呼び出しとツール結果
- 添付ファイル/トランスクリプト（画像、音声、ファイル）
- コンパクションサマリーとプルーニングアーティファクト
- プロバイダーラッパーまたはセーフティヘッダー（表示されないが、カウントされる）

実用的な内訳（注入されたファイルごと、ツール、スキル、システムプロンプトサイズ）については、`/context list`または`/context detail`を使用してください。[Context](/concepts/context)を参照してください。

## 現在のトークン使用量を確認する方法

チャットで以下を使用：

- `/status` → セッションモデル、コンテキスト使用量、最後の応答の入力/出力トークン、**推定コスト**（APIキーのみ）を含む**絵文字リッチステータスカード**。
- `/usage off|tokens|full` → すべての返信に**応答ごとの使用量フッター**を追加。
  - セッションごとに永続化（`responseUsage`として保存）。
  - OAuth認証は**コストを非表示**（トークンのみ）。
- `/usage cost` → OpenClawセッションログからのローカルコストサマリーを表示。

その他のサーフェス：

- **TUI/Web TUI：** `/status` + `/usage`がサポートされています。
- **CLI：** `openclaw status --usage`および`openclaw channels list`は、プロバイダークォータウィンドウを表示します（応答ごとのコストではありません）。

## コスト推定（表示される場合）

コストは、モデル価格設定から推定されます：

```
models.providers.<provider>.models[].cost
```

これらは`input`、`output`、`cacheRead`、`cacheWrite`の**100万トークンあたりのUSD**です。価格設定が欠落している場合、OpenClawはトークンのみを表示します。OAuthトークンはドルコストを表示しません。

## キャッシュTTLとプルーニングの影響

プロバイダープロンプトキャッシングは、キャッシュTTLウィンドウ内でのみ適用されます。OpenClawはオプションで**cache-ttlプルーニング**を実行できます：キャッシュTTLが期限切れになるとセッションをプルーニングし、キャッシュウィンドウをリセットして、その後のリクエストが完全な履歴を再キャッシュする代わりに新しくキャッシュされたコンテキストを再利用できるようにします。これにより、セッションがTTLを超えてアイドル状態になった場合のキャッシュ書き込みコストを低く保ちます。

[Gateway configuration](/gateway/configuration)で設定し、動作の詳細は[Session pruning](/concepts/session-pruning)を参照してください。

ハートビートは、アイドルギャップ全体でキャッシュを**ウォーム**に保つことができます。モデルキャッシュTTLが`1h`の場合、ハートビート間隔をそれよりわずかに短く設定する（例：`55m`）と、完全なプロンプトの再キャッシュを回避でき、キャッシュ書き込みコストを削減できます。

Anthropic API価格設定では、キャッシュ読み取りは入力トークンよりも大幅に安価ですが、キャッシュ書き込みはより高い倍率で請求されます。最新のレートとTTL倍率については、Anthropicのプロンプトキャッシング価格設定を参照してください：
https://docs.anthropic.com/docs/build-with-claude/prompt-caching

### 例：ハートビートで1時間のキャッシュをウォームに保つ

```yaml
agents:
  defaults:
    model:
      primary: "anthropic/claude-opus-4-5"
    models:
      "anthropic/claude-opus-4-5":
        params:
          cacheControlTtl: "1h"
    heartbeat:
      every: "55m"
```

## トークン圧力を減らすためのヒント

- `/compact`を使用して長いセッションを要約。
- ワークフローで大きなツール出力をトリミング。
- スキル説明を短く保つ（スキルリストはプロンプトに注入される）。
- 冗長で探索的な作業には、より小さなモデルを優先。

正確なスキルリストのオーバーヘッド式については、[Skills](/tools/skills)を参照してください。
