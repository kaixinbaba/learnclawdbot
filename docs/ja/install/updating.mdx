---
summary: "OpenClaw の安全な更新（グローバルインストールまたはソース）、およびロールバック戦略"
read_when:
  - OpenClaw を更新するとき
  - 更新後に何か壊れたとき
---

# 更新

OpenClaw は急速に動いています（「1.0」以前）。更新はインフラの配布のように扱ってください：更新 → チェック実行 → 再起動（または `openclaw update` を使用、これは再起動します）→ 検証。

## 推奨：ウェブサイトインストーラを再実行（インプレース更新）

**推奨**される更新パスは、ウェブサイトからインストーラを再実行することです。これは
既存のインストールを検出し、インプレース更新を行い、必要に応じて `openclaw doctor` を実行します。

```bash
curl -fsSL https://openclaw.bot/install.sh | bash
```

注：
- オンボーディングウィザードを再実行したくない場合は、`--no-onboard` を追加してください。
- **ソースインストール**の場合は、次を使用してください：
  ```bash
  curl -fsSL https://openclaw.bot/install.sh | bash -s -- --install-method git --no-onboard
  ```
  インストーラは、リポジトリがクリーンな場合**のみ** `git pull --rebase` を実行します。
- **グローバルインストール**の場合、スクリプトは内部で `npm install -g openclaw@latest` を使用します。
- レガシー注：`openclaw` は互換性シムとして引き続き利用可能です。

## 更新前

- インストール方法を把握：**グローバル**（npm/pnpm）vs **ソースから**（git clone）。
- Gateway の実行方法を把握：**フォアグラウンドターミナル** vs **監視サービス**（launchd/systemd）。
- カスタマイズのスナップショットを取得：
  - 設定：`~/.openclaw/openclaw.json`
  - 認証情報：`~/.openclaw/credentials/`
  - ワークスペース：`~/.openclaw/workspace`

## 更新（グローバルインストール）

グローバルインストール（いずれかを選択）：

```bash
npm i -g openclaw@latest
```

```bash
pnpm add -g openclaw@latest
```
Gateway ランタイムには Bun は**推奨しません**（WhatsApp/Telegram のバグ）。

更新チャネルを切り替える（git + npm インストール）：

```bash
openclaw update --channel beta
openclaw update --channel dev
openclaw update --channel stable
```

ワンオフのインストールタグ / バージョンには `--tag <dist-tag|version>` を使用してください。

チャネルのセマンティクスとリリースノートについては、[開発チャネル](/install/development-channels) を参照してください。

注：npm インストールでは、gateway が起動時に更新ヒントをログに記録します（現在のチャネルタグをチェックします）。`update.checkOnStart: false` で無効化できます。

次に：

```bash
openclaw doctor
openclaw gateway restart
openclaw health
```

注：
- Gateway がサービスとして実行されている場合は、PID を kill するよりも `openclaw gateway restart` が推奨されます。
- 特定のバージョンに固定している場合は、以下の「ロールバック / 固定」を参照してください。

## 更新（`openclaw update`）

**ソースインストール**（git チェックアウト）の場合は、次を優先してください：

```bash
openclaw update
```

これは安全な更新フローを実行します：
- クリーンなワークツリーが必要です。
- 選択したチャネル（タグまたはブランチ）に切り替えます。
- 設定されたアップストリームに対してフェッチ + リベースします（dev チャネル）。
- 依存関係をインストールし、ビルドし、Control UI をビルドし、`openclaw doctor` を実行します。
- デフォルトで gateway を再起動します（スキップするには `--no-restart` を使用）。

**npm/pnpm** 経由でインストールした場合（git メタデータなし）、`openclaw update` はパッケージマネージャー経由で更新を試みます。インストールを検出できない場合は、代わりに「更新（グローバルインストール）」を使用してください。

## 更新（Control UI / RPC）

Control UI には **Update & Restart**（RPC：`update.run`）があります。これは：
1) `openclaw update` と同じソース更新フローを実行します（git チェックアウトのみ）。
2) 構造化されたレポート（stdout/stderr 末尾）で再起動センチネルを書き込みます。
3) gateway を再起動し、最後のアクティブセッションにレポートを ping します。

リベースが失敗した場合、gateway は更新を適用せずに中止して再起動します。

## 更新（ソースから）

リポジトリチェックアウトから：

推奨：

```bash
openclaw update
```

手動（ほぼ同等）：

```bash
git pull
pnpm install
pnpm build
pnpm ui:build # 初回実行時に UI 依存関係を自動インストール
openclaw doctor
openclaw health
```

注：
- パッケージされた `openclaw` バイナリ（[`openclaw.mjs`](https://github.com/openclaw/openclaw/blob/main/openclaw.mjs)）を実行するか、Node を使用して `dist/` を実行する場合、`pnpm build` が重要です。
- グローバルインストールなしでリポジトリチェックアウトから実行する場合は、CLI コマンドに `pnpm openclaw ...` を使用してください。
- TypeScript から直接実行する場合（`pnpm openclaw ...`）、リビルドは通常不要ですが、**設定の移行は依然として適用されます** → doctor を実行してください。
- グローバルインストールと git インストール間の切り替えは簡単です：別のフレーバーをインストールしてから、`openclaw doctor` を実行して、gateway サービスのエントリポイントが現在のインストールに書き換えられるようにします。

## 常に実行：`openclaw doctor`

Doctor は「安全な更新」コマンドです。意図的に退屈です：修復 + 移行 + 警告。

注：**ソースインストール**（git チェックアウト）の場合、`openclaw doctor` はまず `openclaw update` の実行を提案します。

典型的な処理：
- 非推奨の設定キー / レガシー設定ファイルの場所を移行します。
- DM ポリシーを監査し、危険な「open」設定について警告します。
- Gateway の健全性をチェックし、再起動を提案できます。
- 古い gateway サービス（launchd/systemd、レガシー schtasks）を現在の OpenClaw サービスに検出して移行します。
- Linux では、systemd ユーザーの lingering を確保します（Gateway がログアウト後も存続するように）。

詳細：[Doctor](/gateway/doctor)

## Gateway の起動 / 停止 / 再起動

CLI（OS に関係なく動作）：

```bash
openclaw gateway status
openclaw gateway stop
openclaw gateway restart
openclaw gateway --port 18789
openclaw logs --follow
```

監視されている場合：
- macOS launchd（アプリバンドル LaunchAgent）：`launchctl kickstart -k gui/$UID/bot.molt.gateway`（`bot.molt.<profile>` を使用、レガシー `com.openclaw.*` も引き続き動作）
- Linux systemd ユーザーサービス：`systemctl --user restart openclaw-gateway[-<profile>].service`
- Windows（WSL2）：`systemctl --user restart openclaw-gateway[-<profile>].service`
  - `launchctl`/`systemctl` は、サービスがインストールされている場合にのみ動作します。それ以外の場合は `openclaw gateway install` を実行してください。

ランブック + 正確なサービスラベル：[Gateway ランブック](/gateway)

## ロールバック / 固定（何か壊れた場合）

### 固定（グローバルインストール）

既知の良好なバージョンをインストールします（`<version>` を最後に動作したバージョンに置き換えてください）：

```bash
npm i -g openclaw@<version>
```

```bash
pnpm add -g openclaw@<version>
```

ヒント：現在公開されているバージョンを確認するには、`npm view openclaw version` を実行してください。

次に再起動 + doctor を再実行：

```bash
openclaw doctor
openclaw gateway restart
```

### 固定（ソース）日付別

日付からコミットを選択します（例：「2026-01-01 時点の main の状態」）：

```bash
git fetch origin
git checkout "$(git rev-list -n 1 --before=\"2026-01-01\" origin/main)"
```

次に依存関係を再インストール + 再起動：

```bash
pnpm install
pnpm build
openclaw gateway restart
```

後で最新に戻したい場合：

```bash
git checkout main
git pull
```

## 行き詰まった場合

- `openclaw doctor` を再度実行し、出力を注意深く読んでください（多くの場合、修正方法が示されています）。
- チェック：[トラブルシューティング](/gateway/troubleshooting)
- Discord で質問：https://channels.discord.gg/clawd
