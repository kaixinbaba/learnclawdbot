---
summary: "インバウンドチャネルの位置情報解析（Telegram + WhatsApp）とコンテキストフィールド"
read_when:
  - チャネルの位置情報解析を追加または変更するとき
  - エージェントプロンプトやツールで位置情報コンテキストフィールドを使用するとき
---

# チャネルの位置情報解析

OpenClawは、チャットチャネルから共有された位置情報を以下のように正規化します:
- インバウンドボディに追加される人間が読める形式のテキスト
- 自動返信コンテキストペイロード内の構造化フィールド

現在サポートされているもの:
- **Telegram**（位置ピン + ベニュー + ライブ位置情報）
- **WhatsApp**（locationMessage + liveLocationMessage）
- **Matrix**（`geo_uri`を持つ`m.location`）

## テキストフォーマット
位置情報は括弧なしのフレンドリーな行として表示されます:

- ピン:
  - `📍 48.858844, 2.294351 ±12m`
- 名前付き場所:
  - `📍 Eiffel Tower — Champ de Mars, Paris (48.858844, 2.294351 ±12m)`
- ライブ共有:
  - `🛰 ライブ位置情報: 48.858844, 2.294351 ±12m`

チャネルにキャプション/コメントが含まれている場合、次の行に追加されます:
```
📍 48.858844, 2.294351 ±12m
ここで会いましょう
```

## コンテキストフィールド
位置情報が存在する場合、これらのフィールドが`ctx`に追加されます:
- `LocationLat`（数値）
- `LocationLon`（数値）
- `LocationAccuracy`（数値、メートル単位; オプション）
- `LocationName`（文字列; オプション）
- `LocationAddress`（文字列; オプション）
- `LocationSource`（`pin | place | live`）
- `LocationIsLive`（真偽値）

## チャネル別の注意事項
- **Telegram**: ベニューは`LocationName/LocationAddress`にマップされます。ライブ位置情報は`live_period`を使用します。
- **WhatsApp**: `locationMessage.comment`と`liveLocationMessage.caption`はキャプション行として追加されます。
- **Matrix**: `geo_uri`はピン位置情報として解析されます。高度は無視され、`LocationIsLive`は常にfalseです。
