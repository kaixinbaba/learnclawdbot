---
summary: "モデル認証: OAuth、API キー、setup-token"
read_when:
  - モデル認証や OAuth 有効期限のデバッグ時
  - 認証または認証情報ストレージのドキュメント作成時
---
# Authentication（認証）

OpenClaw は、モデルプロバイダーに対して OAuth（オーオース）と API キーをサポートしています。Anthropic アカウントの場合は **API キー** の使用を推奨します。Claude サブスクリプションアクセスの場合は、`claude setup-token` で作成された長期有効なトークンを使用してください。

OAuth フローとストレージレイアウトの詳細は [/concepts/oauth](/concepts/oauth) を参照してください。

## 推奨される Anthropic セットアップ（API キー）

Anthropic を直接使用する場合は、API キーを使用してください。

1) Anthropic Console で API キーを作成します。
2) **ゲートウェイホスト**（`openclaw gateway` を実行しているマシン）に配置します。

```bash
export ANTHROPIC_API_KEY="..."
openclaw models status
```

3) ゲートウェイが systemd/launchd で実行されている場合は、デーモンが読み取れるように `~/.openclaw/.env` にキーを配置することを推奨します：

```bash
cat >> ~/.openclaw/.env <<'EOF'
ANTHROPIC_API_KEY=...
EOF
```

その後、デーモンを再起動（またはゲートウェイプロセスを再起動）して再確認します：

```bash
openclaw models status
openclaw doctor
```

環境変数を自分で管理したくない場合は、オンボーディングウィザードがデーモン用に API キーを保存できます：`openclaw onboard`。

環境変数の継承（`env.shellEnv`、`~/.openclaw/.env`、systemd/launchd）の詳細は [Help](/help) を参照してください。

## Anthropic: setup-token（サブスクリプション認証）

Anthropic の場合、推奨パスは **API キー** です。Claude サブスクリプションを使用している場合は、setup-token フローもサポートされています。**ゲートウェイホスト** で実行してください：

```bash
claude setup-token
```

その後、OpenClaw に貼り付けます：

```bash
openclaw models auth setup-token --provider anthropic
```

トークンが別のマシンで作成された場合は、手動で貼り付けてください：

```bash
openclaw models auth paste-token --provider anthropic
```

次のような Anthropic エラーが表示される場合：

```
This credential is only authorized for use with Claude Code and cannot be used for other API requests.
```

…代わりに Anthropic API キーを使用してください。

手動トークン入力（任意のプロバイダー；`auth-profiles.json` を書き込み、設定を更新します）：

```bash
openclaw models auth paste-token --provider anthropic
openclaw models auth paste-token --provider openrouter
```

自動化に適したチェック（期限切れ/不足時は終了コード `1`、期限切れ間近時は `2`）：

```bash
openclaw models status --check
```

オプションの運用スクリプト（systemd/Termux）はこちらに文書化されています：
[/automation/auth-monitoring](/automation/auth-monitoring)

> `claude setup-token` にはインタラクティブな TTY が必要です。

## モデル認証ステータスの確認

```bash
openclaw models status
openclaw doctor
```

## 使用する認証情報の制御

### セッション単位（チャットコマンド）

`/model <alias-or-id>@<profileId>` を使用して、現在のセッションの特定のプロバイダー認証情報をピン留めします（プロファイル ID の例：`anthropic:default`、`anthropic:work`）。

コンパクトなピッカーには `/model`（または `/model list`）を使用し、完全なビュー（候補 + 次の認証プロファイル、設定時はプロバイダーエンドポイント詳細を含む）には `/model status` を使用してください。

### エージェント単位（CLI オーバーライド）

エージェントに対して明示的な認証プロファイル順序のオーバーライドを設定します（そのエージェントの `auth-profiles.json` に保存されます）：

```bash
openclaw models auth order get --provider anthropic
openclaw models auth order set --provider anthropic anthropic:default
openclaw models auth order clear --provider anthropic
```

特定のエージェントをターゲットにするには `--agent <id>` を使用します。省略すると、設定されたデフォルトエージェントが使用されます。

## トラブルシューティング

### "No credentials found"

Anthropic トークンプロファイルが見つからない場合は、**ゲートウェイホスト** で `claude setup-token` を実行してから、再確認してください：

```bash
openclaw models status
```

### トークンの期限切れ/期限切れ間近

`openclaw models status` を実行して、どのプロファイルが期限切れ間近かを確認してください。プロファイルが見つからない場合は、`claude setup-token` を再実行して、トークンを再度貼り付けてください。

## 要件

- Claude Max または Pro サブスクリプション（`claude setup-token` 用）
- Claude Code CLI のインストール（`claude` コマンドが利用可能）
