---
summary: "エンベロープ、プロンプト、ツール、コネクター全体での日付と時刻の処理"
read_when:
  - タイムスタンプがモデルまたはユーザーに表示される方法を変更する場合
  - メッセージまたはシステムプロンプト出力での時刻フォーマットをデバッグする場合
---

# 日付と時刻

OpenClawは、**トランスポートタイムスタンプにはホストローカル時刻**、**システムプロンプトにのみユーザータイムゾーン**をデフォルトとしています。プロバイダータイムスタンプは保持されるため、ツールはネイティブのセマンティクスを維持します（現在の時刻は`session_status`経由で利用可能）。

## メッセージエンベロープ（デフォルトはローカル）

受信メッセージはタイムスタンプ（分精度）でラップされます：

```
[Provider ... 2026-01-05 16:26 PST] message text
```

このエンベロープタイムスタンプは、プロバイダータイムゾーンに関係なく、**デフォルトでホストローカル**です。

この動作を上書きできます：

```json5
{
  agents: {
    defaults: {
      envelopeTimezone: "local", // "utc" | "local" | "user" | IANAタイムゾーン
      envelopeTimestamp: "on", // "on" | "off"
      envelopeElapsed: "on" // "on" | "off"
    }
  }
}
```

- `envelopeTimezone: "utc"`はUTCを使用。
- `envelopeTimezone: "local"`はホストタイムゾーンを使用。
- `envelopeTimezone: "user"`は`agents.defaults.userTimezone`を使用（ホストタイムゾーンにフォールバック）。
- 固定ゾーンには明示的なIANAタイムゾーン（例：`"America/Chicago"`）を使用。
- `envelopeTimestamp: "off"`はエンベロープヘッダーから絶対タイムスタンプを削除。
- `envelopeElapsed: "off"`は経過時間の接尾辞（`+2m`スタイル）を削除。

### 例

**ローカル（デフォルト）：**

```
[WhatsApp +1555 2026-01-18 00:19 PST] hello
```

**ユーザータイムゾーン：**

```
[WhatsApp +1555 2026-01-18 00:19 CST] hello
```

**経過時間有効：**

```
[WhatsApp +1555 +30s 2026-01-18T05:19Z] follow-up
```

## システムプロンプト：現在の日付と時刻

ユーザータイムゾーンがわかっている場合、システムプロンプトには専用の**現在の日付と時刻**セクションが含まれ、プロンプトキャッシングを安定させるために**タイムゾーンのみ**（時計/時刻フォーマットなし）が含まれます：

```
Time zone: America/Chicago
```

エージェントが現在の時刻を必要とする場合は、`session_status`ツールを使用します。ステータスカードにはタイムスタンプ行が含まれます。

## システムイベント行（デフォルトはローカル）

エージェントコンテキストに挿入されるキューに入れられたシステムイベントは、メッセージエンベロープと同じタイムゾーン選択を使用したタイムスタンプが先頭に付きます（デフォルト：ホストローカル）。

```
System: [2026-01-12 12:19:17 PST] Model switched.
```

### ユーザータイムゾーン+フォーマットの設定

```json5
{
  agents: {
    defaults: {
      userTimezone: "America/Chicago",
      timeFormat: "auto" // auto | 12 | 24
    }
  }
}
```

- `userTimezone`はプロンプトコンテキスト用の**ユーザーローカルタイムゾーン**を設定。
- `timeFormat`はプロンプトでの**12時間/24時間表示**を制御。`auto`はOSの設定に従う。

## 時刻フォーマット検出（auto）

`timeFormat: "auto"`の場合、OpenClawはOSの設定（macOS/Windows）を検査し、ロケールフォーマットにフォールバックします。検出された値は、システムコールの繰り返しを避けるために**プロセスごとにキャッシュ**されます。

## ツールペイロード+コネクター（生のプロバイダー時刻+正規化フィールド）

チャネルツールは**プロバイダーネイティブタイムスタンプ**を返し、一貫性のために正規化されたフィールドを追加します：

- `timestampMs`：エポックミリ秒（UTC）
- `timestampUtc`：ISO 8601 UTC文字列

生のプロバイダーフィールドは保持されるため、何も失われません。

- Slack：APIからのエポック風文字列
- Discord：UTC ISOタイムスタンプ
- Telegram/WhatsApp：プロバイダー固有の数値/ISOタイムスタンプ

ローカル時刻が必要な場合は、既知のタイムゾーンを使用して下流で変換します。

## 関連ドキュメント

- [System Prompt](/concepts/system-prompt)
- [Timezones](/concepts/timezone)
- [Messages](/concepts/messages)
