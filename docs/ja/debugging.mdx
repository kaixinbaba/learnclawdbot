---
summary: "デバッグツール：ウォッチモード、生のモデルストリーム、推論リーク追跡"
read_when:
  - 推論リークのために生のモデル出力を検査する必要がある場合
  - 反復処理中にGatewayをウォッチモードで実行したい場合
  - 再現可能なデバッグワークフローが必要な場合
---

# デバッグ

このページでは、ストリーミング出力用のデバッグヘルパーを説明します。特に、プロバイダーが推論を通常のテキストに混ぜる場合に有効です。

## ランタイムデバッグオーバーライド

チャットで`/debug`を使用して、**ランタイムのみ**の設定オーバーライド（メモリ、ディスクではない）を設定します。`/debug`はデフォルトで無効です。`commands.debug: true`で有効にします。これは、`openclaw.json`を編集せずに不明瞭な設定を切り替える必要がある場合に便利です。

例：

```
/debug show
/debug set messages.responsePrefix="[openclaw]"
/debug unset messages.responsePrefix
/debug reset
```

`/debug reset`はすべてのオーバーライドをクリアし、ディスク上の設定に戻ります。

## Gatewayウォッチモード

高速な反復処理のために、ファイルウォッチャーの下でgatewayを実行します：

```bash
pnpm gateway:watch --force
```

これは以下にマップされます：

```bash
tsx watch src/entry.ts gateway --force
```

`gateway:watch`の後に任意のgateway CLIフラグを追加でき、再起動ごとに渡されます。

## Devプロファイル + dev gateway（--dev）

devプロファイルを使用して状態を分離し、デバッグ用の安全で使い捨て可能なセットアップを起動します。**2つ**の`--dev`フラグがあります：

- **グローバル`--dev`（プロファイル）：** `~/.openclaw-dev`の下で状態を分離し、gatewayポートをデフォルトで`19001`にします（派生ポートはそれに応じてシフト）。
- **`gateway --dev`：Gatewayに、欠落している場合にデフォルトの設定+ワークスペースを自動作成**するよう指示（BOOTSTRAP.mdをスキップ）。

推奨フロー（devプロファイル + devブートストラップ）：

```bash
pnpm gateway:dev
OPENCLAW_PROFILE=dev openclaw tui
```

まだグローバルインストールがない場合は、`pnpm openclaw ...`経由でCLIを実行します。

これが行うこと：

1) **プロファイル分離**（グローバル`--dev`）
   - `OPENCLAW_PROFILE=dev`
   - `OPENCLAW_STATE_DIR=~/.openclaw-dev`
   - `OPENCLAW_CONFIG_PATH=~/.openclaw-dev/openclaw.json`
   - `OPENCLAW_GATEWAY_PORT=19001`（browser/canvasはそれに応じてシフト）

2) **Devブートストラップ**（`gateway --dev`）
   - 欠落している場合に最小限の設定を書き込む（`gateway.mode=local`、ループバックバインド）。
   - `agent.workspace`をdevワークスペースに設定。
   - `agent.skipBootstrap=true`を設定（BOOTSTRAP.mdなし）。
   - 欠落している場合にワークスペースファイルをシード：
     `AGENTS.md`、`SOUL.md`、`TOOLS.md`、`IDENTITY.md`、`USER.md`、`HEARTBEAT.md`。
   - デフォルトアイデンティティ：**C3‑PO**（プロトコルドロイド）。
   - devモードでチャネルプロバイダーをスキップ（`OPENCLAW_SKIP_CHANNELS=1`）。

リセットフロー（新規開始）：

```bash
pnpm gateway:dev:reset
```

注：`--dev`は**グローバル**プロファイルフラグであり、一部のランナーに食われます。明示的に綴る必要がある場合は、環境変数形式を使用します：

```bash
OPENCLAW_PROFILE=dev openclaw gateway --dev --reset
```

`--reset`は設定、認証情報、セッション、devワークスペースを消去し（`rm`ではなく`trash`を使用）、デフォルトのdevセットアップを再作成します。

ヒント：非devのgatewayがすでに実行されている場合（launchd/systemd）、最初に停止します：

```bash
openclaw gateway stop
```

## 生ストリームロギング（OpenClaw）

OpenClawは、フィルタリング/フォーマットの前に**生のアシスタントストリーム**をログに記録できます。これは、推論がプレーンテキストデルタとして到着しているか（または別の思考ブロックとして）を確認する最良の方法です。

CLI経由で有効化：

```bash
pnpm gateway:watch --force --raw-stream
```

オプションのパスオーバーライド：

```bash
pnpm gateway:watch --force --raw-stream --raw-stream-path ~/.openclaw/logs/raw-stream.jsonl
```

同等の環境変数：

```bash
OPENCLAW_RAW_STREAM=1
OPENCLAW_RAW_STREAM_PATH=~/.openclaw/logs/raw-stream.jsonl
```

デフォルトファイル：

`~/.openclaw/logs/raw-stream.jsonl`

## 生チャンクロギング（pi-mono）

ブロックに解析される前の**生のOpenAI互換チャンク**をキャプチャするために、pi-monoは別のロガーを公開します：

```bash
PI_RAW_STREAM=1
```

オプションのパス：

```bash
PI_RAW_STREAM_PATH=~/.pi-mono/logs/raw-openai-completions.jsonl
```

デフォルトファイル：

`~/.pi-mono/logs/raw-openai-completions.jsonl`

> 注：これはpi-monoの`openai-completions`プロバイダーを使用するプロセスによってのみ出力されます。

## 安全上の注意

- 生ストリームログには、完全なプロンプト、ツール出力、ユーザーデータが含まれる可能性があります。
- ログをローカルに保管し、デバッグ後に削除してください。
- ログを共有する場合は、最初にシークレットとPIIをスクラブしてください。
