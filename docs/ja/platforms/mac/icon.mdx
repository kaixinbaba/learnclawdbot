---
title: "メニューバーアイコンの状態"
summary: "macOS 上の OpenClaw のメニューバーアイコンの状態とアニメーション"
read_when:
  - メニューバーアイコンの動作を変更する場合
---
# メニューバーアイコンの状態

著者: steipete · 更新日: 2025-12-06 · スコープ: macOS アプリ (`apps/macos`)

- **アイドル:** 通常のアイコンアニメーション（まばたき、時折の揺れ）。
- **一時停止:** ステータスアイテムは `appearsDisabled` を使用し、動きなし。
- **音声トリガー（大きな耳）:** Voice wake検出器がウェイクワードを検知すると `AppState.triggerVoiceEars(ttl: nil)` を呼び出し、発話がキャプチャされている間 `earBoostActive=true` を維持します。耳は1.9倍にスケールアップし、可読性のために円形の耳孔を持ち、1秒の沈黙後に `stopVoiceEars()` によって元に戻ります。アプリ内音声パイプラインからのみ発火します。
- **作業中（エージェント実行中）:** `AppState.isWorking=true` が「尾/脚の小走り」マイクロモーションを駆動します：作業中はより速い脚の揺れとわずかなオフセット。現在は WebChat エージェント実行の前後で切り替えられます。他の長時間タスクを接続する際に同じトグルを追加してください。

配線ポイント
- Voice wake: ランタイム/テスターはトリガー時に `AppState.triggerVoiceEars(ttl: nil)` を呼び出し、キャプチャウィンドウに合わせて1秒の沈黙後に `stopVoiceEars()` を呼び出します。
- エージェントアクティビティ: 作業スパンの前後で `AppStateStore.shared.setWorking(true/false)` を設定します（WebChat エージェント呼び出しで既に実装済み）。スパンを短く保ち、`defer` ブロックでリセットして、アニメーションが固まるのを防ぎます。

形状とサイズ
- ベースアイコンは `CritterIconRenderer.makeIcon(blink:legWiggle:earWiggle:earScale:earHoles:)` で描画されます。
- 耳のスケールはデフォルトで `1.0`。音声ブーストは `earScale=1.9` を設定し、全体のフレームを変更せずに `earHoles=true` を切り替えます（18×18 pt テンプレート画像が 36×36 px Retina バッキングストアにレンダリングされます）。
- 小走りは脚の揺れを最大約1.0まで使用し、小さな水平方向のジグル付き。既存のアイドル揺れに追加されます。

動作に関する注意事項
- 耳/作業中の外部 CLI/ブローカートグルはありません。誤ったフラッピングを避けるため、アプリ自身のシグナルに内部的に保ちます。
- TTL を短く（<10秒）保ち、ジョブがハングした場合でもアイコンが素早くベースラインに戻るようにします。
